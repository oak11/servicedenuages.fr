<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Service de nuages</title><link href="http://www.servicedenuages.fr/en/" rel="alternate"></link><link href="http://www.servicedenuages.fr/feeds/service-de-nuages.atom.xml" rel="self"></link><id>http://www.servicedenuages.fr/en/</id><updated>2015-10-27T00:00:00+01:00</updated><entry><title>Kinto.js 1.0 released</title><link href="http://www.servicedenuages.fr/en/kinto-js-1-0-released" rel="alternate"></link><updated>2015-10-27T00:00:00+01:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-10-27:en/kinto-js-1-0-released</id><summary type="html">&lt;p&gt;&lt;a class="reference external" href="https://kintojs.readthedocs.org/"&gt;Kinto.js&lt;/a&gt; is an offline-first JavaScript client leveraging the &lt;a class="reference external" href="https://kinto.readthedocs.org/"&gt;Kinto API&lt;/a&gt; for data synchronization. In a world where connectivity isn't always guaranteed, local persistence in the browser has become an &lt;a class="reference external" href="http://offlinefirst.org/"&gt;identified priority&lt;/a&gt; for Web applications, especially on mobile.&lt;/p&gt;
&lt;p&gt;The basic principle is simple; save your data locally, assuming there's no network connectivity. Then as soon as it's available, retrieve remote changes and push your local data to a remote server.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;kinto&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Kinto&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="nx"&gt;remote&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"https://kinto.dev.mozaws.net/v1/"&lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;tasks&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;kinto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;collection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"tasks"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="nx"&gt;tasks&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;create&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="nx"&gt;label&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"Test kinto.js"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;done&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
  &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;_&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nx"&gt;tasks&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;sync&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
  &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;ok&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nx"&gt;alert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"Data have been synchronized!"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Local persistence in the browser is achieved using &lt;a class="reference external" href="https://www.w3.org/TR/IndexedDB/"&gt;IndexedDB&lt;/a&gt;, and we've tried hard to hide its inherent low-level usage complexity — mainly due to its fully asynchronous nature — through a simpler yet convenient &lt;a class="reference external" href="https://www.promisejs.org/"&gt;Promises&lt;/a&gt; based API.&lt;/p&gt;
&lt;p&gt;Kinto.js provides basic local CRUD operations for &lt;a class="reference external" href="https://kintojs.readthedocs.org/en/latest/api/#creating-a-record"&gt;creating&lt;/a&gt;, &lt;a class="reference external" href="https://kintojs.readthedocs.org/en/latest/api/#updating-a-record"&gt;updating&lt;/a&gt;, &lt;a class="reference external" href="https://kintojs.readthedocs.org/en/latest/api/#deleting-records"&gt;deleting&lt;/a&gt;, &lt;a class="reference external" href="https://kintojs.readthedocs.org/en/latest/api/#retrieving-a-single-record"&gt;retrieving&lt;/a&gt; and &lt;a class="reference external" href="https://kintojs.readthedocs.org/en/latest/api/#listing-records"&gt;listing&lt;/a&gt; records from a local collection. Each time you want to reflect its state to a remote server, you only ever have to &lt;a class="reference external" href="https://kintojs.readthedocs.org/en/latest/api/#fetching-and-publishing-changes"&gt;call the sync() method&lt;/a&gt;!&lt;/p&gt;
&lt;p&gt;We've set up a &lt;a class="reference external" href="https://kinto.github.io/kinto.js/"&gt;simple demo application&lt;/a&gt; using a public Mozilla test server instance, so you can check how it behaves by yourself if you're interested. The source code of this app is &lt;a class="reference external" href="https://github.com/Kinto/kinto.js/blob/66ef077796a8e4a8b0d9a95389a61ea57cbbfde3/demo/demo.js"&gt;available on Github&lt;/a&gt;, and is also the base use case for the &lt;a class="reference external" href="http://kintojs.readthedocs.org/en/latest/tutorial/"&gt;Kinto.js tutorial&lt;/a&gt; you should probably take if you want to get your feet wet.&lt;/p&gt;
&lt;div class="note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;Please note that this public Kinto test server instance is flushed every morning at 7AM UTC, so don't rely on it for production use ;)&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="synchronizing-and-reconciling-data"&gt;
&lt;h2&gt;Synchronizing and reconciling data&lt;/h2&gt;
&lt;p&gt;Synchronizing local and remote data is a tough topic, and conflicts may occur quite easily if things are changing often from different sources (think multiple devices updating a same server); Kinto.js supports three distinct &lt;em&gt;synchronization strategies&lt;/em&gt; to handle such a situation:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;The server is authoritative: all conflicting records are overriden locally by their version from the server;&lt;/li&gt;
&lt;li&gt;The client is authoritative: all conflicting records are resolved using their local versions, and force-pushed to the server;&lt;/li&gt;
&lt;li&gt;No party is authoritative: the synchronization flow is halted, and all conflicting records are explicitely exposed, so developers can then decide how they want resolve each of them individually.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You can read more about &lt;a class="reference external" href="https://kintojs.readthedocs.org/en/latest/api/#resolving-conflicts-manually"&gt;conflict resolution&lt;/a&gt; and &lt;a class="reference external" href="http://kintojs.readthedocs.org/en/latest/api/#synchronization-strategies"&gt;sychronization strategies&lt;/a&gt; in the dedicated sections of the project documentation.&lt;/p&gt;
&lt;p&gt;The diagram flow below describes pretty much accurately what's happening under the hood when &lt;tt class="docutils literal"&gt;sync()&lt;/tt&gt; is called:&lt;/p&gt;
&lt;img alt="Kinto.js synchronization flow" src="http://www.servicedenuages.fr/en/../images/kintojs-sync-flow.png" style="width: 654px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;div class="section" id="a-case-for-encryption"&gt;
&lt;h2&gt;A case for encryption&lt;/h2&gt;
&lt;p&gt;Remote data storage is certainly a topic raising concerns when it comes to security and privacy.&lt;/p&gt;
&lt;p&gt;To help addressing these issues, Kinto.js exposes a &lt;a class="reference external" href="http://kintojs.readthedocs.org/en/latest/api/#transformers"&gt;Remote Transformers API&lt;/a&gt;, which allow processing records before they're sent to the server and after they've been retrieved from it.&lt;/p&gt;
&lt;p&gt;This is a perfect hook for supporting end-to-end encryption, which &lt;a class="reference external" href="http://www.servicedenuages.fr/en/kinto-encryption-example"&gt;we already wrote about earlier&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="getting-started"&gt;
&lt;h2&gt;Getting started&lt;/h2&gt;
&lt;p&gt;We already mentioned the &lt;a class="reference external" href="http://kintojs.readthedocs.org/en/latest/tutorial/"&gt;Kinto.js tutorial&lt;/a&gt;, but there's more; we've created a rather opinionated  &lt;a class="reference external" href="https://github.com/Kinto/kinto-react-boilerplate"&gt;Kinto.js + React boilerplate&lt;/a&gt;, so you can bootstrap your next offline-first Web application in no time ;)&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="current-limitations"&gt;
&lt;h2&gt;Current limitations&lt;/h2&gt;
&lt;p&gt;We've listed Kinto.js current limitations — the ones we're aware of — in a &lt;a class="reference external" href="http://kintojs.readthedocs.org/en/latest/limitations/"&gt;dedicated section of the documentation&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Sure, that's a bunch of work remaining, and you're obviously &lt;a class="reference external" href="http://kintojs.readthedocs.org/en/latest/hacking/"&gt;invited to contribute&lt;/a&gt; if you want to help!&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="the-future-of-kinto-js"&gt;
&lt;h2&gt;The future of Kinto.js&lt;/h2&gt;
&lt;p&gt;Of course 1.0 is a very first step towards a broader goal; foremost, we absolutely want to support bulk updates by taking advantage of IndexedDB transactions, for performance and consistency purposes.&lt;/p&gt;
&lt;p&gt;So stay tuned for next upcoming releases, and feel free to provide feedback on the &lt;a class="reference external" href="https://mail.mozilla.org/listinfo/kinto"&gt;project mailing-list&lt;/a&gt; or by &lt;a class="reference external" href="https://github.com/Kinto/kinto.js/issues/new"&gt;filing an issue on Github&lt;/a&gt; :)&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="update"&gt;
&lt;h2&gt;Update&lt;/h2&gt;
&lt;p&gt;We're not even done polishing this blog post and the &lt;a class="reference external" href="https://github.com/Kinto/kinto.js/releases/tag/v1.1.0"&gt;1.1 version is already there&lt;/a&gt;! Take it the easy way, that means the project is on steroids ;)&lt;/p&gt;
&lt;/div&gt;
</summary></entry><entry><title>Looking for an Outreachy intern this winter</title><link href="http://www.servicedenuages.fr/en/outreach-kinto-2016" rel="alternate"></link><updated>2015-10-01T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-10-01:en/outreach-kinto-2016</id><summary type="html">&lt;blockquote class="epigraph"&gt;
&lt;p&gt;By having a program targeted specifically towards women, we found that we
reached talented and passionate participants, who were uncertain about how to
start otherwise.&lt;/p&gt;
&lt;p&gt;We are now expanding the program to people from more groups underrepresented
in FOSS. We hope this effort will help many people learn how exciting, varied
and valuable work on FOSS projects can be and how inclusive the community
really is.&lt;/p&gt;
&lt;p class="attribution"&gt;—&lt;a class="reference external" href="https://wiki.gnome.org/Outreachy"&gt;The GNOME Outreachy program wiki&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;In our team, and at Mozilla in general, we thrive to build an inclusive
community. And we believe being more inclusive starts by reaching to the people
who are often underrepresented in tech.&lt;/p&gt;
&lt;p&gt;That's why we are participating in the GNOME Outreachy program this year by
proposing an internship around Kinto and making instances discoverable.&lt;/p&gt;
&lt;p&gt;Check out the eligibility details at the end of the article if you're
interested!&lt;/p&gt;
&lt;div class="section" id="making-kinto-instances-discoverable"&gt;
&lt;h2&gt;Making Kinto instances discoverable&lt;/h2&gt;
&lt;p&gt;The &lt;a class="reference external" href="https://kinto.readthedocs.org"&gt;Kinto project&lt;/a&gt; aims to bring storage
instances to everyone, attached to their
&lt;a class="reference external" href="https://accounts.firefox.com"&gt;Firefox Accounts&lt;/a&gt; (Well, it actually supports
multiple authentication schemes, but we want to promote Firefox Accounts as a
first step).&lt;/p&gt;
&lt;p&gt;Currently, Kinto is thought of as a centralised server: there is one instance, and
everyone authenticates on this instance. Items are shared between users of a
same instance.&lt;/p&gt;
&lt;p&gt;This doesn't resonate well with many of our goals: scalability is harder
when there is one endpoint, and it's also not interoperable.&lt;/p&gt;
&lt;p&gt;For instance, imagine Alice and Bob. Bob is using Mozilla's servers to store
his data, whereas Alice deployed her own Kinto instance.&lt;/p&gt;
&lt;p&gt;There are different use cases:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Alice wants to use &lt;a class="reference external" href="https://github.com/leplatrem/routina"&gt;Routina&lt;/a&gt;, an
application that stores its data inside a Kinto instance. As such, Routina
needs a way to discover where it should store its data, and send the requests
to this server.&lt;/li&gt;
&lt;li&gt;Bob and Alice want to collaborate on a set of data (think about a webapp to
manage their shared expenses). There should be a way for Alice to host
everything and grant access to Bob on her data. The webapp should be able to
use the correct server.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Here are the different steps that could allow these scenarios:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;At the moment they authenticate, the client detects the email address used,
and relies on the domain part to do a
&lt;a class="reference external" href="https://tools.ietf.org/html/rfc7033"&gt;Web Finger&lt;/a&gt; request on the domain
&lt;a class="footnote-reference" href="#id2" id="id1"&gt;[1]&lt;/a&gt; and for the specified user.&lt;/li&gt;
&lt;li&gt;In case the identified server doesn't support WebFinger, it uses a central
repository to lookup where the Kinto server is located.&lt;/li&gt;
&lt;li&gt;Once the Kinto server is located, all requests should be issued against this
server.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In terms of code changes, here is what it looks like (rough step by step). The
details are still to be fleshed out - this is a rough first version:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Update the &lt;a class="reference external" href="https://github.com/Kinto/kinto.js"&gt;Kinto.js client&lt;/a&gt; to find the
server location. It should first rely on WebFinger.&lt;/li&gt;
&lt;li&gt;Create a central repository of server locations. This could be contained in
the FxA profile server or in a central Kinto collection.&lt;/li&gt;
&lt;li&gt;Update the Kinto.js client to fall-back to this central repository in case no
Web Finger exists.&lt;/li&gt;
&lt;li&gt;Investigate on ways to store this information directly in the web browser.
It could also be configurable by the JavaScript client (with
an UX that looks like &lt;a class="reference external" href="https://remotestorage.io/"&gt;what Remote Storage proposes&lt;/a&gt;).&lt;/li&gt;
&lt;li&gt;Work on the first user experience: how can client learn they can chose which
server to use?&lt;/li&gt;
&lt;li&gt;Ship it!&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="want-to-join"&gt;
&lt;h2&gt;Want to join?&lt;/h2&gt;
&lt;p&gt;So, if you think that this project is exciting and you would like to join,
please check that you:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Identify as a woman (cis or trans), a trans man, or genderqueer person or you
are a resident or national of the United States of any gender who is
Black/African American, Hispanic/Latin@, American Indian, Alaska Native,
Native Hawaiian, or Pacific Islander;&lt;/li&gt;
&lt;li&gt;Are or will be 18 years of age or older by December 7, 2015;&lt;/li&gt;
&lt;li&gt;Are available for a full-time, 40 hours a week internship between
December and March.&lt;/li&gt;
&lt;li&gt;Think that open source software makes a difference, and would like to work
with us on going further with making a kick-ass Kinto ecosystem;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Check the eligibility details &lt;a class="reference external" href="https://wiki.gnome.org/Outreachy#Program_Details"&gt;on the section of the GNOME wiki&lt;/a&gt; and get it touch with us!&lt;/p&gt;
&lt;p&gt;If you are not sure how to get started, the best way is to start reading &lt;a class="reference external" href="https://kinto.readthedocs.org"&gt;the
documentation&lt;/a&gt;, especially
&lt;a class="reference external" href="http://kinto.readthedocs.org/en/latest/tutorials/first-steps.html"&gt;the tutorials&lt;/a&gt;
and then reach out to us by joining the
&lt;a class="reference external" href="https://mail.mozilla.org/listinfo/kinto"&gt;Kinto development mailing list&lt;/a&gt; and
the &lt;cite&gt;#storage&lt;/cite&gt; channel on irc.mozilla.org.&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id2" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;It is also possible to use the same mechanism to discover the FxA
endpoints. But as FxA isn't a federated protocol, users from one FxA
realm would need to be explicitely accepted by the Kinto server, in its
configuration.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
</summary></entry><entry><title>How to encrypt data with Kinto.js</title><link href="http://www.servicedenuages.fr/en/kinto-encryption-example" rel="alternate"></link><updated>2015-09-16T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-09-16:en/kinto-encryption-example</id><summary type="html">&lt;p&gt;A guest post this time, by &lt;a class="reference external" href="https://michielbdejong.com/"&gt;Michiel de Jong&lt;/a&gt;
from the Firefox OS team!&lt;/p&gt;
&lt;p&gt;If you want to encrypt data that is uploaded to the cloud by an offline-first app,
it makes sense to keep the local copy of the data in-the-clear, and encrypt the
data only just before it is uploaded. That way, you can easily and efficiently display
and update the local copy of the data, without the repeated cost of encrypting
and decrypting everything all the time. Likewise, you only need to decrypt incoming data
once, when it's downloaded, and your app can then display the data as often as
needed without extra processing costs.&lt;/p&gt;
&lt;p&gt;Syncing data to and from "the cloud" is a science in itself, and
&lt;a class="reference external" href="https://github.com/Kinto/kinto.js"&gt;Kinto.js&lt;/a&gt; is a brilliant tool for this, developed
by the equally brilliant Mozilla Services team. It's nearing its 1.0 release, and you'll
hear a lot more about it on this blog in the future.&lt;/p&gt;
&lt;p&gt;It so happens that Kinto.js now supports
&lt;a class="reference external" href="http://kintojs.readthedocs.org/en/latest/api/#transformers"&gt;RemoteTransformers&lt;/a&gt;,
which are superhandy for any type of transformation you may want to do on your data
before it is saved into the locally cached copy (&lt;tt class="docutils literal"&gt;RemoteTransformer#decode&lt;/tt&gt;), and before it is uploaded to the
remote server (&lt;tt class="docutils literal"&gt;RemoteTransformer#encode&lt;/tt&gt;).&lt;/p&gt;
&lt;p&gt;This blogpost shows how to use a &lt;tt class="docutils literal"&gt;RemoteTransformer&lt;/tt&gt; for encrypting your data just
before it's sent to the cloud. It uses WebCrypto for the cryptography.&lt;/p&gt;
&lt;p&gt;Note that I am not a security expert and this is just an example I wrote in an afternoon, so
if you're going to copy-paste this code, please don't use it for anything
valuable without doing your own proper security review first! :) For instance, it does
not do any key stretching etcetera, it's just a very basic encrypt/decrypt
proof-of-concept.&lt;/p&gt;
&lt;p&gt;The main idea behind a &lt;tt class="docutils literal"&gt;RemoteTransformer&lt;/tt&gt; is that you provide two functions,
&lt;tt class="docutils literal"&gt;encode&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;decode&lt;/tt&gt;, and Kinto.js makes sure to call the encode function on
each record that gets uploaded, and to call the decode function on each record
that gets downloaded. You can also read about this
&lt;a class="reference external" href="http://kintojs.readthedocs.org/en/latest/api/#transformers"&gt;in the Kinto.js documentation&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The way we tell Kinto.js that we want to use our custom
&lt;tt class="docutils literal"&gt;encode&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;decode&lt;/tt&gt; procedures, is quite simple. When creating a Kinto
collection, we pass a &lt;tt class="docutils literal"&gt;RemoteTransformer&lt;/tt&gt; as a collection-level option. The full
code example is
&lt;a class="reference external" href="/scripts/kinto-encryption-example.js"&gt;here&lt;/a&gt; (note that it only works with
&lt;a class="reference external" href="/scripts/kinto-61ad959.min.js"&gt;latest Kinto.js master&lt;/a&gt;),
but let's walk through the code step-by-step.&lt;/p&gt;
&lt;p&gt;If you're unfamiliar with ES6, you may be surprised by some of this syntax; so let's
take this opportunity to get used to it! Here's a little translation:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://babeljs.io/docs/learn-es2015/#arrows-and-lexical-this"&gt;() =&amp;gt; {}&lt;/a&gt; is similar to &lt;tt class="docutils literal"&gt;(function() &lt;span class="pre"&gt;{}).bind(this)&lt;/span&gt;&lt;/tt&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://babeljs.io/docs/learn-es2015/#let-const"&gt;const foo = 'bar'; let foo = 'bar';&lt;/a&gt; are similar to &lt;tt class="docutils literal"&gt;var foo = 'bar'&lt;/tt&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://babeljs.io/docs/learn-es2015/#enhanced-object-literals"&gt;{ a, b }&lt;/a&gt; is similar to &lt;tt class="docutils literal"&gt;{ a: a, b: b }&lt;/tt&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://babeljs.io/docs/learn-es2015/#template-strings"&gt;`Hello ${foo}`&lt;/a&gt; (note the backticks) is similar to &lt;tt class="docutils literal"&gt;'Hello ' + foo&lt;/tt&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;First, we need a few helper functions, which will be used later on to convert between
&lt;a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Typed_arrays"&gt;byte arrays&lt;/a&gt;
and ASCII strings.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;// Helper functions:&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;rawStringToByteArray&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;str&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;strLen&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;str&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;byteArray&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;strLen&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nx"&gt;strLen&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;byteArray&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;str&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;charCodeAt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;byteArray&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;base64StringToByteArray&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;base64&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;rawStringToByteArray&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;atob&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;base64&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;byteArrayToBase64String&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;bytes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;binary&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;''&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;bytes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;byteLength&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nx"&gt;binary&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="nb"&gt;String&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;fromCharCode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;bytes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;btoa&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;binary&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Next, we need to create a &lt;tt class="docutils literal"&gt;RemoteTransformer&lt;/tt&gt; that can encode and decode records. And for
that, we need to generate an
&lt;a class="reference external" href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard"&gt;AES&lt;/a&gt; key.
&lt;a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto"&gt;WebCrypto&lt;/a&gt; is a
fairly new part of &lt;a class="reference external" href="https://platform.html5.org/"&gt;the web platform&lt;/a&gt; and it's awesome.
We will use that key to encrypt and decrypt
the data that is passed through the &lt;tt class="docutils literal"&gt;RemoteTransformer&lt;/tt&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;// RemoteTransformer:&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;generateAesKey&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="c1"&gt;// See http://www.w3.org/TR/WebCryptoAPI/#examples-symmetric-encryption&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;crypto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;subtle&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;generateKey&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt; &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'AES-GCM'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;128&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt;
       &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'encrypt'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'decrypt'&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;

&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;createTransformer&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;aesKey&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;encode&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;cleartext&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;rawStringToByteArray&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;stringify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;IV&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;crypto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getRandomValues&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;crypto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;subtle&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;encrypt&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt; &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'AES-GCM'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;iv&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;IV&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="nx"&gt;aesKey&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nx"&gt;cleartext&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;ciphertext&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;id&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nx"&gt;ciphertext&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;byteArrayToBase64String&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;ciphertext&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
        &lt;span class="nx"&gt;IV&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;byteArrayToBase64String&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;IV&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;};&lt;/span&gt;
    &lt;span class="p"&gt;});&lt;/span&gt;
  &lt;span class="p"&gt;};&lt;/span&gt;

  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;decode&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;ciphertext&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;base64StringToByteArray&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;ciphertext&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;IV&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;base64StringToByteArray&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;IV&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;crypto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;subtle&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;decrypt&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt; &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'AES-GCM'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;iv&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;IV&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="nx"&gt;aesKey&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nx"&gt;ciphertext&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;recordArrayBuffer&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;

      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;String&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;fromCharCode&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;apply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
          &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;recordArrayBuffer&lt;/span&gt;&lt;span class="p"&gt;)));&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;undecryptable&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;});&lt;/span&gt;
  &lt;span class="p"&gt;};&lt;/span&gt;

  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;decode&lt;/span&gt;
  &lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We create two Kinto instances, so that we can test syncing from one instance
to the other, via the public Kinto demo instance on AWS. Creating multiple Kinto
instances within the same origin is now possible with the recently added
&lt;tt class="docutils literal"&gt;dbPrefix&lt;/tt&gt; option:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;// Kinto collection:&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;createCollection&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;transformer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;testRun&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;instanceNo&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;kinto&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Kinto&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
    &lt;span class="nx"&gt;dbPrefix&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="err"&gt;`&lt;/span&gt;&lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;testRun&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;instanceNo&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="err"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;remote&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'https://kinto.dev.mozaws.net/v1/'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nx"&gt;Authorization&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'Basic '&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;btoa&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'public-demo:s3cr3t'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;

  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;kinto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;collection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="err"&gt;`&lt;/span&gt;&lt;span class="nx"&gt;kinto&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;encryption&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;example&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;testRun&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="err"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;remoteTransformers&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nx"&gt;transformer&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;

&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;coll1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;coll2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;prepare&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;generateAesKey&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;aesKey&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;createTransformer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;aesKey&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;transformer&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// Create two fresh empty Kinto instances for testing:&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;testRun&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nb"&gt;Date&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;getTime&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
    &lt;span class="nx"&gt;coll1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;createCollection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;transformer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;testRun&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="nx"&gt;coll2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;createCollection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;transformer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;testRun&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, let's test if we can create an item in collection 1, sync it up (the data
should be encrypted on the wire, we can check that on the Network tab of the
browser console):&lt;/p&gt;
&lt;img alt="Network tab screenshot" src="http://www.servicedenuages.fr/en/../images/kinto-encryption-example-network-tab.png" style="width: 2560px; height: auto; max-width: 100%;"/&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;syncUp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="c1"&gt;// Use first Kinto instance to demonstrate encryption:&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;coll1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;create&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
    &lt;span class="nx"&gt;URL&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'http://www.w3.org/TR/WebCryptoAPI/'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'Web Cryptography API'&lt;/span&gt;
  &lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;coll1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;sync&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
  &lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;syncResults&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Sync up'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;syncResults&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And sync it down from the cloud again using collection 2. Again, the data
coming in on the wire should be encrypted, but the decrypted results should
show up in the sync results. And finally, a 'go()' method to put it all together.&lt;/p&gt;
&lt;p&gt;The full source code is included in a script tag on this page you're reading right
now, so go ahead and try opening your browser console on this page to try it out!&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;syncDown&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="c1"&gt;// Use second Kinto instance to demonstrate decryption:&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;coll2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;sync&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;syncResults&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Sync down'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;syncResults&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;

&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;go&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Watch the Network tab!'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;prepare&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
      &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;syncUp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;syncDown&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Success'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;a&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
            &lt;span class="nx"&gt;b&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Failure'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;b&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Type go(); to start!'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Hope you are as excited about Kinto.js as I am, comments below this blogpost
and github issues on the example code very welcome! :)&lt;/p&gt;
</summary></entry><entry><title>Signing collection to ensure data integrity</title><link href="http://www.servicedenuages.fr/en/data-signature" rel="alternate"></link><updated>2015-08-26T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-08-26:en/data-signature</id><summary type="html">&lt;div class="note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;Translated from the French by &lt;a class="reference external" href="https://twitter.com/Natim"&gt;Rémy Hubscher&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Within the scope of the &lt;a class="reference external" href="https://wiki.mozilla.org/Firefox/Go_Faster"&gt;Go Faster&lt;/a&gt;
project, we want to distribute Firefox updates more often than
just with major updates (which happens once every six weeks).&lt;/p&gt;
&lt;p&gt;There are multiple kinds of data that we will need to update on the client;
for example, we would like to &lt;a class="reference external" href="https://blog.mozilla.org/security/2015/03/03/revoking-intermediate-certificates-introducing-onecrl/"&gt;update the SSL Control Revocation List (named
OneCRL)&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In that specific case, it is obviously very important to make sure that all the
retrieved data are coming from Mozilla and that no records are missing. We can
then be absolutely confident that nobody has attempted to invalidate a valid
certificate to the list (or remove one that has been revoked).&lt;/p&gt;
&lt;p&gt;A cryptographic signature can give us the guarantee that all the records where
fetched but it is still possible to prevent users from completely accessing the
service (the &lt;em&gt;Great Firewall of China&lt;/em&gt;, for example).&lt;/p&gt;
&lt;p&gt;This mechanism works in our specific use-case of the OneCRL update project, but
it can also be useful to any future project that needs to make sure that all
records on a collection have been correctly synced. We will probably need to
re-use it to update other parts of Firefox (or Fennec), but you may also want
to use it for your projects.&lt;/p&gt;
&lt;p&gt;We plan to use &lt;a class="reference external" href="https://kinto.readthedocs.org"&gt;Kinto&lt;/a&gt; in order to distribute
the data (or meta-data) associated with the files that need to be updated. It's
a good fit because it can be cached easily behind a CDN.&lt;/p&gt;
&lt;p&gt;That said, we don't want our users to trust either the CDN or the Kinto server
itself without checking. Somebody can attack the CDN or the Kinto server and
may add or remove records and update the CRL. If you think about it is a
horrible scenario.&lt;/p&gt;
&lt;p&gt;Consider the following work-flow:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;The person responsible for updating the CRL, &lt;em&gt;the updater&lt;/em&gt;, has got a
private key (or even better &lt;a class="reference external" href="https://en.wikipedia.org/wiki/Hardware_Security_Module"&gt;an HSM&lt;/a&gt;) which
will enable them to sign a hash of the collection records.&lt;/li&gt;
&lt;li&gt;The corresponding public key ships with the client (Firefox or Fennec).&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Hashing&lt;/em&gt; and &lt;em&gt;signature&lt;/em&gt; generation are done on client side to prevent certain
attacks vectors (if somebody can access the Kinto server, for example).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The &lt;em&gt;hashing&lt;/em&gt; is a one-way operation that guarantees the same result given the
same input.&lt;/p&gt;
&lt;div class="section" id="first-data-issuance-on-kinto"&gt;
&lt;h2&gt;First data issuance on Kinto&lt;/h2&gt;
&lt;p&gt;All the data are fetched from a &lt;em&gt;secure&lt;/em&gt; source and converted into a JSON
collection. Each record is assigned a unique ID generated on client side.&lt;/p&gt;
&lt;p&gt;For instance, we could have the following record:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;"id"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"b7dded96-8df0-8af8-449a-8bc47f71b4c4"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
 &lt;span class="s2"&gt;"fingerprint"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"11:D5:D2:0A:9A:F8:D9:FC:23:6E:5C:5C:30:EC:AF:68:F5:68:FB:A3"&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then the collection &lt;em&gt;hash&lt;/em&gt; is computed, signed, and then sent to the Kinto
server. (See below for details.)&lt;/p&gt;
&lt;p&gt;The signature process is deported to a specific service in a sandbox
that ensures the certificate security which is crucial in the process.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="how-to-validate-data-integrity"&gt;
&lt;h2&gt;How to validate data integrity?&lt;/h2&gt;
&lt;p&gt;First, we need to fetch the collection records as well as the hash and
the signature.&lt;/p&gt;
&lt;p&gt;Then, we can validate that the hash signature is valid to make sure it
has been generated by a trusted source.&lt;/p&gt;
&lt;p&gt;Finally we can serialise our local collection and compute its hash to
make sure it matches the signed one.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="update-the-collection-data"&gt;
&lt;h2&gt;Update the collection data&lt;/h2&gt;
&lt;p&gt;When you need to &lt;a class="reference external" href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete"&gt;create, read, update or delete&lt;/a&gt;
records in the collection, the client needs to make sure that the local
collection records match those of the remote server, and that they are valid.&lt;/p&gt;
&lt;p&gt;Once we are confident that the collection update is valid, the client
can compute the new collection hash and sign it.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="how-to-compute-the-collection-hash"&gt;
&lt;h2&gt;How to compute the collection hash?&lt;/h2&gt;
&lt;p&gt;To compute the collection &lt;em&gt;hash&lt;/em&gt; you need a reproducible algorithm.&lt;/p&gt;
&lt;p&gt;For instance one could be:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Sort records by their ids.&lt;/li&gt;
&lt;li&gt;Serialise fields giving the value of each keys sorted by key.&lt;/li&gt;
&lt;li&gt;Compute the &lt;em&gt;hash&lt;/em&gt; of the records list serialization.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;We do not yet know the exact algorithm that we will be using.&lt;/p&gt;
&lt;p&gt;An interesting candidate could be the &lt;a class="reference external" href="https://tools.ietf.org/html/draft-ietf-jose-json-web-signature-41"&gt;JSON Web Signature&lt;/a&gt;
standard. Meanwhile, a naive Python implementation could look like
this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;json&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;hashlib&lt;/span&gt;

&lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
   &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;"id"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;"b7dded96-8df0-8af8-449a-8bc47f71b4c4"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s"&gt;"fingerprint"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;"11:D5:D2:0A:9A:F8:D9:FC:23:6E:5C:5C:30:EC:AF:68:F5:68:FB:A3"&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
   &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;"id"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;"dded96b7-8f0d-8f8a-49a4-7f771b4c4bc4"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s"&gt;"fingerprint"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;"33:6E:5C:5C:30:EC:AF:68:F5:68:FB:A3:11:D5:D2:0A:9A:F8:D9:FC"&lt;/span&gt;&lt;span class="p"&gt;}]&lt;/span&gt;

&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;hashlib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sha256&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dumps&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sort_keys&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;collection_hash&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here is a little sketch to summarise:&lt;/p&gt;
&lt;img alt="Summary schema of the collection signing flow." class="align-center" src="http://www.servicedenuages.fr/en/../images/kinto-signing.jpg" style="width: 600px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
</summary></entry><entry><title>Notifications in Kinto (Preamble)</title><link href="http://www.servicedenuages.fr/en/notifications-kinto-preamble" rel="alternate"></link><updated>2015-08-13T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-08-13:en/notifications-kinto-preamble</id><summary type="html">&lt;p&gt;At a recent work week in the lovely French town of &lt;a href="https://www.qwant.com/?q=Douarnenez&amp;amp;t=images"&gt;Douarnenez&lt;/a&gt; we laid the groundwork for an upcoming feature in &lt;a href="https://kinto.readthedocs.org"&gt;Kinto&lt;/a&gt;: &lt;em&gt;Notifications!&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="Sunset over Douarnenez (@phrawzty)" src="http://www.servicedenuages.fr/en/../images/notifications-douarnenez.jpg" style="width: 800px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;h1&gt;tl;dr&lt;/h1&gt;
&lt;p&gt;For those that are in a hurry, here's the gist: We're going to be integrating a "notifications" system into Kinto with an eye towards simplicity, modernity, and flexibility. Our goal is to provide a solid framework that will allow other systems to take advantage of this new feature without having to jump through too many hoops. If that sounds interesting to you - read on.&lt;/p&gt;
&lt;h1&gt;Why?&lt;/h1&gt;
&lt;p&gt;The simple answer is that we have an itch to scratch at Mozilla. There is a platform called &lt;a href="https://wiki.mozilla.org/Balrog"&gt;Balrog&lt;/a&gt; which is part of the update system used by Firefox and other Mozilla products. As part of an initiative to extend and improve the update process (the "&lt;a href="https://wiki.mozilla.org/Firefox/Go_Faster"&gt;Go Faster&lt;/a&gt;" initiative), we needed to store and transmit small, discrete blocks of information both between internal systems, as well as out to all of our users in the real world. Kinto has almost all the functionality we need except for one thing: notifications.&lt;/p&gt;
&lt;p&gt;No problem. We can do that.&lt;/p&gt;
&lt;h2&gt;But wait, there's more!&lt;/h2&gt;
&lt;p&gt;Sure, Kinto is a Mozilla project - but it's meant for general use, which means that anything we design needs to be reasonably generic. With this in mind we committed to designing something that can be used in a variety of contexts; after all, we're an organisation built for and on the web, and as such, we're dedicated to using web-centric solutions.&lt;/p&gt;
&lt;p&gt;Thinking then about what sort of parameters a reasonably generic solution might entail lead us to a few basic guidelines for designing the notifications mechanism:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;We should strive to be as &lt;em&gt;agnostic&lt;/em&gt; as possible, meaning that locking into a particular service, back-end, or even programming language, should be avoided where possible.&lt;/li&gt;
&lt;li&gt;Since we're web-centric, we should capitalise on HTTP wherever possible as well.&lt;/li&gt;
&lt;li&gt;The notifications mechanism must be able to scale with a minimum of hardship; this applies to any eventual queues, workers, and so forth.&lt;/li&gt;
&lt;li&gt;Finally, it must be robust - we can't be losing messages now, can we?&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;What?&lt;/h1&gt;
&lt;p&gt;Before we go into the gritty details, let's take a moment to describe the overall picture of what we're trying to accomplish - on paper, at least, it's fairly straightforward:&lt;/p&gt;
&lt;p&gt;&lt;div class="graphviz" style="align: center;"&gt;&lt;img src="data:image/png;base64,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GQoKCp44raH0rYmIiGq/GnscPFXMysoKAPDKK68gMTERbm5uOqGjefPmAIBWrVpVab43btzAJ598og075b788svHpt2yZQuaN28OlUoFa2trrFq16qnTGqIqNRERUe3HIyNGZvny5WjatClCQkJw/fp1bbuZWVluNDc313temZmZeP/995GTk6PX9Onp6VAoFFUruIqqWhMREdV+PDJiZJo1a4aIiAgEBAQgKCgImzZtemoAyc/Px9q1a6FUKlFSUoKLFy/C2dkZgYGBsLGxwbZt23D58mVYWVkhNDQUCxYsgEajwb59+3D48GFcv34dGzduxKFDh3Do0CEUFRUhOzsboaGhAICZM2fiyJEjOtMCQFFREeLi4nDx4kVYW1vjzJkz6Nu3LwICAqBUKpGWloYVK1agXbt2yMjIQEZGBubOnQsXFxe9a6ps/aytrfHDDz/g8OHDOHz4MBISEhASEoLjx4+jXbt2CA0NhbOzc81sNCIiMohCGPALdm+99RYAID4+vtJpz50796yLqTM6deqEs2fPAgA2bdqEZcuWwd/fHx9//PFj7xcUFGD06NHw8vLC1KlTAQA5OTl49913UVJSgoSEBFhbW6NTp05o27YtduzYoV1Obm4uevTo8Vi7PtOWlpZiypQpaNKkCRYvXgylUonExESEhIRg9erV6NOnDwYPHozS0lLs2rULJSUl6NmzJ5o3b47t27frvZzK1i8+Ph6FhYUYMmQI7t27hw8++ADe3t64fPkypk6dipdffhmbN29+HpupVuGv9hKRoRQKBeLi4rSZ4Bkk8DSNkfLz84Onpyc2btyI5OTkx97fsGED0tLS4OPjo21r3LgxJk2ahBs3bmDdunVPnbeNjY3edTw6bWxsLH766ScEBgZCqSzrPsOGDUNYWBheffVVAIC/vz8mTJgAAFAqlbCzs0NaWlqVllPZ+q1fvx729vZo1qwZACAwMBAtW7ZEjx490KRJE/z+++96ryMREcnF0zRGSqFQIDQ0FBcvXkRwcDASExN13j916hQAoGHDhjrtXbt2BQCcPn26wnlXpY6HHT9+HABgb2+vbTMzM8OwYcO0f/bx8UF+fj5iYmKQl5eH4uJilJaWVmk5+q7fo59TKBSwtrbGrVu3Kl03IiIyDjwyYsQaNmyIlStXoqioCHPmzNF5r/yoRHp6uk57kyZNAPzv7pzq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"/&gt;&lt;/div&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A &lt;em&gt;message&lt;/em&gt; is a chunk of information which is being sent from one place to another - for example, an HTTP request. Messages can come from &lt;em&gt;somewhere else&lt;/em&gt;, such as an external service, or can be generated internally.&lt;/li&gt;
&lt;li&gt;An &lt;em&gt;action&lt;/em&gt; is some sort of processing which occurs as a result of the message. This could be something simple like incrementing a counter in memory. Alternatively, it could be much more complex - triggering a test and build process, for example. These can be native functions of Kinto, local executables, features from plugins, or just about anything else.&lt;/li&gt;
&lt;li&gt;A &lt;em&gt;result&lt;/em&gt;, as the name implies, is the outcome of the &lt;em&gt;action&lt;/em&gt;. A simple example would be the aforementioned in-memory counter, expressed as an integer, and wrapped into a nice JSON package. Alternatively, it could be the meta-data results from that theoretical build and test process (the possibilities are endless).&lt;/li&gt;
&lt;li&gt;Taken as a whole, &lt;em&gt;events&lt;/em&gt; can therefore be thought of as a cycle: a message is received, an action takes place, some work is accomplished, and a new message is generated.&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;A notification is the combination of an incoming message and the action which is subseqently triggered. The result, while related directly to the action, is not itself part of the notification.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;It's a fine distinction that bears further explanation. The originator of the incoming message isn't necessarily concerned with what Kinto does with the data - in general, it's sufficient to know that Kinto has received the message and that it will be treated appropriately. In this way we can maintain simple promises between each of the components in the greater system.&lt;/p&gt;
&lt;p&gt;In any case, we'll explore some more terminology later - but for now let's move along.&lt;/p&gt;
&lt;h1&gt;How?&lt;/h1&gt;
&lt;p&gt;There are about as many ways to go about solving the problem as there are grains of sand on a beach (warning: previous statement may not be scientifically valid). The best way to determine the winning approach is simple: through single combat, &lt;a href="https://duckduckgo.com/?q=beyond+thunderdome&amp;amp;ia=about"&gt;Thunderdome-style&lt;/a&gt;. Unfortunately our manager put the kibosh on that plan for liability reasons, so instead we did the next best thing: we drew on a whiteboard.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Whiteboard (@leplatrem)" src="http://www.servicedenuages.fr/en/../images/notifications-whiteboard.jpg" style="width: 675px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;In the interest of absolutely transparency, here are some of the models that we worked through and our general observations on each.&lt;/p&gt;
&lt;h2&gt;The Simple&lt;/h2&gt;
&lt;p&gt;One approach is to be as &lt;a href="https://i.imgur.com/xZQitlj.gi"&gt;hands-off&lt;/a&gt; as possible. The premise here is straightforward enough: Kinto drops notifications into a queue (like Redis or RabbitMQ). That's basically it.&lt;/p&gt;
&lt;p&gt;&lt;div class="graphviz" style="align: center;"&gt;&lt;img src="data:image/png;base64,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"/&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;Pros:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;This model implies a highly limited scope insofar as Kinto is directly concerned; we would basically treat Kinto like a lightweight transport mechanism, and the queue as a fire-and-forget target.&lt;/li&gt;
&lt;li&gt;The amount of additional code would be relatively small - in essence, only just enough to speak to a queue service and nothing more.&lt;/li&gt;
&lt;li&gt;Depending on how active the community was, we would be able to support a reasonably large number of external queuing services.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Cons:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Each queuing service would require a dedicated module to be coded and maintained, the responsibility for which would likely fall to the community as part of the larger ecosystem.&lt;/li&gt;
&lt;li&gt;It's ultimately up to the final consumer (receiver, destination, whatever) of the message to deal with the queue. In other words, if the queue is RabbitMQ, then the consumer needs to able to speak RabbitMQ too.&lt;/li&gt;
&lt;li&gt;Kinto has no control, understanding, or insight into what happens once the message is handed off to the queuing service.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The simplicity of this model, while attractive, has some fatal flaws. Chiefly, it runs contrary to our guideline of tech agnosticism as it would impose a particular external service dependency on the &lt;em&gt;consumer&lt;/em&gt;. Furthermore, this model flirts with danger in terms of robustness as the fire-and-forget model isn't exactly optimised for reliability (not all queuing mechanisms are better than others, however).&lt;/p&gt;
&lt;h2&gt;The Integrated&lt;/h2&gt;
&lt;p&gt;We then considered what might happen if we were to swing the pendulum directly to the opposite of the spectrum from the previous solution. In this model, we would tightly couple the queuing service directly within Kinto and provide an API that the consumer could subscribe to.&lt;/p&gt;
&lt;p&gt;&lt;div class="graphviz" style="align: center;"&gt;&lt;img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAoMAAACYCAYAAACf4OP/AAAABmJLR0QA/wD/AP+gvaeTAAAgAElEQVR4nO3dd3wU1d4/8M9szWZTCRAIhBKMQJDyiICKgHSk1yAKiF5vEPXKtaD+sAsq8Ag8CihElI5C4CrNK4/GQtErKKIIgSgECJAQStgkm2Tr+f3Bs2MCKUuyu7Ob/bxfr3kRZqd8Z3bKd8/MOUcSQggQERERUTBKUykdAREREREph8kgERERURBjMkhEREQUxJgMEhEREQUxJoNEREREQYzJIBEREVEQYzJIREREFMSYDBIREREFMSaDREREREGMySARERFREGMySERERBTEmAwSERERBTEmg0RERERBjMkgERERURDT1GbmgoICXL582VOxEBER0TUkSUJcXBy0Wq3SoVAdVatk0GQyoaioyFOxEBERUQWKi4sRGRmpdBhUR/ExMREREVEQYzJIREREFMSYDBIREREFMSaDREREREGMySARERFREGMySERERBTEmAwSERERBTEmg0RERERBjMkgERERURCrVQ8kN6J169bsSqcKQghkZWWhuLhY6VDIC9RqtTxoNJpy/1epVFCpVJX+rVLV/jebw+GA0+mUh7L/d/3tcDjkwW63y387nU4P7AGiykmSBK1WC51OB51OB61WC41GU25Qq9VuLct17Nrtdnmw2WywWq2wWq2w2WwQQnh5i6isvXv3ok+fPrBarUqHEtR0Oh2+/vprdO/e/brPfJYMMhGsmutiSIFFo9HIN66y/7pubK6EryLX3pAkSfJanBUllBXdECuKQQgBh8MBm80Gu90Oq9Uq32Bd/9psNiaN5Ba9Xo+QkBB5MBgM0Gj+uhWVPS5rck7odLpql2Wz2VBaWlpusFgsN7wucs/Zs2dhtVqxceNGpUMJasnJyTh79myFn/ksGSQKRJIkyaUVrhILvV4PvV4PrVZb7gZzozcxbyZ/7nB3/ZIkyaUzwF/bee38DocDVqsVFoulXCmMxWKB3W73bPAUECRJgsFggNFoRGhoKIxGo/zDRAhR4THoyfOismW5frCFhYXJ0zidTpjNZpjNZhQXF6OkpIQliB42btw4pUOgSjAZJPo/Op3uulILnU4n3ywqS4JclE7ufKWy7VSr1TAYDAgJCbluOqfTeV0pTGlpKRwOh09iJt9Rq9UIDw9HREQE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R48exaxZszBlyhTs3LkTJpMJALBz504MHjwYiYmJmDVrFs6ePYs+ffogIyMD+/btw6ZNmzy2DKJgwZJBIiLyGpVKhQ0bNuDEiROYNm0aiouLAQBmsxkPP/wwCgsLsWXLFuh0Onme+fPno3fv3vif//kfTJw4EXfddReSkpIwceJE5OfnQ6VSIT09HSNGjMCnn36Kp59+Gnl5eVi3bh0iIiI8tgyiYCEJIYTSQRARkX9LTk4GAGzcuLFG8xcWFuL999/H7Nmz0bRpU5jNZvzjH/9ASkpKnUi+art/iBSUxsfERETkdeHh4Xj22Weh1+vxz3/+E1qtFj179qwTiSBRoONjYiIi8pnp06djwYIFUKlUGDJkCNv0I/IDTAaJiMinnnzySWRmZuLxxx/Hyy+/jGnTpmHJkiVKh0UUtPiYmIiIfK5Zs2Z45ZVX8MorrygdClHQY8kgERERURBjMkhEREQUxJgMEhEREQUxJoNEREREQYzJIBEREVEQYzJIREREFMSYDBIREREFMSaDREREREGMySARERFREGMySERERBTEmAwSERERBTEmg0RERERBjMkgERERURDTKB0AERH5P7VajU8++QSSJCkdit+69957lQ6BqEYkIYRQOggiIvJvJ06cwM8//6x0GH6tc+fOSEhIUDoMohuVxmSQiIiIKHil8Z1BIiIioiDGZJCIiIgoiDEZJCIiIgpi/x8cVDpXHjoSTQAAAABJRU5ErkJggg=="/&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;Pros:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kinto could be shipped as a "turn-key" solution with a fully functioning stack baked right in; while there would be a queuing service involved (&lt;a href="http://www.celeryproject.org/"&gt;Celery&lt;/a&gt;, for example), it would be completely abstracted by Kinto.&lt;/li&gt;
&lt;li&gt;Since the queuing mechanism is integral, Kinto would have full visibility and control over processing and delivery.&lt;/li&gt;
&lt;li&gt;Apart from the queuing service there would be no additional services or software to deploy.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Cons:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;This would involve a fairly serious increase in the scope, complexity, and size of the Kinto code base.&lt;/li&gt;
&lt;li&gt;The tight coupling means that Kinto, in its entirety, would need to be re-deployed if changes were necessary in the queuing service.&lt;/li&gt;
&lt;li&gt;Similarly, scaling the queue would imply scaling Kinto itself&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This model has certain interesting advantages; however, the relative volume of additional code that would need to be developed is reason enough to give us pause (&lt;a href="https://en.wikipedia.org/wiki/Scope_creep"&gt;scope creep&lt;/a&gt; is a real problem). Like the previous model, this also runs afoul of our tech agnosticism guideline since we would be locking Kinto to a given queuing service directly. Finally, we have (admittedly theoretical) concerns about how this model would scale - it feels like a waste to increase two resources when only one needs to grow, for example.&lt;/p&gt;
&lt;h2&gt;The Broker&lt;/h2&gt;
&lt;p&gt;The final approach is a bit of a mix of the previous two. In this model, we implement a formal "broker" that is part of the Kinto &lt;em&gt;eco-system&lt;/em&gt;, but external to Kinto itself. The broker could be anything from a few lines of Python sitting on a &lt;a href="https://en.wikipedia.org/wiki/Named_pipe"&gt;pipe&lt;/a&gt; to a proper micro-service stack. This decouples the queuing mechanism from Kinto while preserving a strong &lt;em&gt;promise&lt;/em&gt; of interoperability and control.&lt;/p&gt;
&lt;p&gt;&lt;div class="graphviz" style="align: center;"&gt;&lt;img src="data:image/png;base64,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"/&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;Pros:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Provides a clean and easily understandable separation of responsibilities.&lt;/li&gt;
&lt;li&gt;Frees both Kinto and the consumer from any particular service dependency since the transport is pure HTTP between all the components.&lt;/li&gt;
&lt;li&gt;Permits the broker to scale independently from Kinto.&lt;/li&gt;
&lt;li&gt;Requires only a moderate amount of new code in Kinto itself.&lt;/li&gt;
&lt;li&gt;Effectively allows for a highly flexible solution where just about anything imaginable could be plugged in.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Cons:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The broker must speak HTTP and respond properly to a specification of our choosing.&lt;/li&gt;
&lt;li&gt;Functionally requires deploying and maintaining two services (the difficulty of which varies according the complexity of the broker).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We like this model because it satisfies most of our guidelines (and violates none). To be fair, the requirement for "robustness" is a little hand-wavey in this case. We are effectively handing the responsibility to another component; however, since interoperability is a promise, we can maintain an acceptable degree of confidence in the process.&lt;/p&gt;
&lt;p&gt;Another interesting aspect of this model is that by by decoupling the broker from Kinto, one can more easily introduce business logic that would be inappropriate within Kinto itself. A notable example of this is error handling - the manner in which we deal with, say, Balrog delivery issues isn't necessarily universal, and wouldn't make any sense outside of our particular use case.&lt;/p&gt;
&lt;p&gt;A final point worth mentioning here is that the broker could, in principle, be the &lt;em&gt;consumer itself&lt;/em&gt;, which fits into some of the potential use-cases at Mozilla quite nicely.&lt;/p&gt;
&lt;h1&gt;Roadmap&lt;/h1&gt;
&lt;p&gt;As you may have guessed, we've decided to go with the third option (The Broker). From here we have a plan to get from idea to reality, starting with a proof of concept, then through to a &lt;a href="https://en.wikipedia.org/wiki/Minimum_viable_product"&gt;minimum viable product&lt;/a&gt;, and then iterating through improvements until we get to something that's useful to a wider audience.&lt;/p&gt;
&lt;p&gt;Concretely speaking the proof of concept will require:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Defining the &lt;em&gt;types&lt;/em&gt; of events; functionally, this means specifying the behaviour and scope of &lt;code&gt;pre-&lt;/code&gt; and &lt;code&gt;post-&lt;/code&gt; patterns, as well as the structure of the payload.&lt;/li&gt;
&lt;li&gt;Construct a framework for synchronous internal Python events using &lt;a href="http://docs.pylonsproject.org/projects/pyramid//en/latest/narr/events.html"&gt;Pyramid events&lt;/a&gt; (something we have &lt;a href="https://github.com/spiral-project/daybed/blob/master/daybed/events.py"&gt;experience with already&lt;/a&gt;).&lt;/li&gt;
&lt;li&gt;Implement a "listener" in Kinto for those events in order to execute an action.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;From there, we'll move on to the minimum viable product:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Build a minimalist HTTP service that receives a notification via an HTTP &lt;code&gt;POST&lt;/code&gt;, performs an action, and communicates the result to Balrog directly.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Once the model is validated we'll begin the iterative improvement process. This will likely take the form of a "standard broker" which we create and maintain as part of the formal ecosystem. We also like the idea of subscribers registering themselves to the broker using an endpoint (such as webhooks), but that's a discussion for future time.&lt;/p&gt;
&lt;h1&gt;Feedback&lt;/h1&gt;
&lt;p&gt;As always, we're interested in feedback from the community - feel free to use the Disqus form below to join the conversation!&lt;/p&gt;</summary></entry><entry><title>Making the case for Cliquet?</title><link href="http://www.servicedenuages.fr/en/why-cliquet" rel="alternate"></link><updated>2015-07-14T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-07-14:en/why-cliquet</id><summary type="html">&lt;div class="note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;Translated from the French by &lt;a class="reference external" href="https://twitter.com/phrawzty"&gt;Dan Phrawzty&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;tl;dr Cliquet is a Python toolkit for building APIs that implements best
practices in terms of production use and the HTTP protocol.&lt;/strong&gt;&lt;/p&gt;
&lt;div class="section" id="the-origins"&gt;
&lt;h2&gt;The Origins&lt;/h2&gt;
&lt;p&gt;The objective for the first trimester of 2015 was to build a service for
storage and the &lt;a class="reference external" href="http://www.servicedenuages.fr/en/../service-de-nuages"&gt;synchronisation of a reading list&lt;/a&gt;. At the outset of the project we
tried assembling all of the best practices and recommendations from different
teams and currently deployed projects. Also, we wanted to take advantage of the
&lt;em&gt;Firefox Sync&lt;/em&gt; protocol for offline sync since it's robust and proven.&lt;/p&gt;
&lt;p&gt;Rather than write &lt;a class="reference external" href="http://blog.octo.com/en/design-a-rest-api/"&gt;yet another&lt;/a&gt;
&lt;a class="reference external" href="http://www.vinaysahni.com/best-practices-for-a-pragmatic-restful-api"&gt;article&lt;/a&gt;
we decided to assemble what was already out there into a more formalised
protocol.&lt;/p&gt;
&lt;p&gt;At the time we had two projects in the pipeline that obeyed more or less the
same rules, so we decided go with a common implementation of these best
practices (and resulting protocol) in the form of a re-usable toolkit.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Cliquet&lt;/em&gt; was born.&lt;/p&gt;
&lt;img alt="Cliquet logo" class="align-center" src="http://www.servicedenuages.fr/en/../images/cliquet-logo.png" style="width: 300px; height: auto; max-width: 100%;"/&gt;
&lt;div class="section" id="the-intentions"&gt;
&lt;h3&gt;The Intentions&lt;/h3&gt;
&lt;blockquote class="epigraph"&gt;
What JSON structure should I use for my API? Which syntax for filtering
the querystring? How do I deal with concurrent writes? And what about
synchronising data on the client-side?&lt;/blockquote&gt;
&lt;p&gt;Today, when a new project wants to take advantage of a REST API for storing and
consuming data, it is entirely reasonable to use the stock HTTP protocol and
to concentrate only on the bare essentials. This goes for the clients as well,
since the majority of code that handles interaction with the server is
reusable.&lt;/p&gt;
&lt;blockquote class="epigraph"&gt;
How can I verify if the service is operational? How about StatsD?  Is
Sentry configured properly? How can I deploy a new version without breaking
client apps?&lt;/blockquote&gt;
&lt;p&gt;Cliquet provides everything you need to get you started in production - by
design, the transition from prototype to operational service is smooth and
rapid. Out of the box, the service will have facilities for monitoring and
configuration, as well as aides for deployment and version deprecation. As
these realities evolve in the real world, so does the toolkit.&lt;/p&gt;
&lt;blockquote class="epigraph"&gt;
Which storage backend should I use for the JSON documents? What happens if
the Ops team mandates that we use PostgreSQL? And what if we want to
switch to a Redis, or even memory-based backend, for local testing and
development?&lt;/blockquote&gt;
&lt;p&gt;One word: abstraction. This concept lies at the heart of our our entire
implementation. Those two projects mentioned previously were, at their most
simple, HTTP services that exposed a CRUD REST API backed by persistent JSON
data stores. Since neither Pyramid nor Cornice (which we'll touch on later)
were quite ready to handle this situation, we decided to introduce some classes
to abstract the rudiments of both the REST model and of storage backends in
general.&lt;/p&gt;
&lt;p&gt;An important tenet in all of our projects is that of flexibility. This means
that we try to make things optional where we can (and malleable where we
can't) - Cliquet is no different. &lt;em&gt;Everything is configurable&lt;/em&gt; right from the
&lt;tt class="docutils literal"&gt;.ini&lt;/tt&gt; file! What's more, all of the projects that use the toolkit are
deployed in exactly the same way - only the &lt;em&gt;configuration&lt;/em&gt; is different.&lt;/p&gt;
&lt;img alt="A meeting in Paris..." class="align-center" src="http://www.servicedenuages.fr/en/../images/cliquet-notes-whiteboard.jpg" style="width: 500px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="the-protocol"&gt;
&lt;h2&gt;The Protocol&lt;/h2&gt;
&lt;blockquote class="epigraph"&gt;
Is a REST API sufficient? Is it really necessary to re-read the HTTP spec
every time? Why are we reinventing the same protocol over and over?&lt;/blockquote&gt;
&lt;p&gt;As a group, web developers tend to spend way too much energy on reinventing
the wheel with every project, which is especially heinous since many of the
decisions are arbitrary at best. This behaviour can at least partially
explained by the sheer immensity of the HTTP specification, and all which it
contains, including header formats, CORS support, content negotiation and mime
types - not to mention trickier topics like the difference between authentication
and authorisation, and how to interpret HTTP status codes...&lt;/p&gt;
&lt;p&gt;In Cliquet, these are the principal questions we sought to answer definitively:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;REST resources&lt;/strong&gt;: The two URLs of a resource (one each for collections and
records) accept verbs and precise headers.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Formats&lt;/strong&gt;: The structure of the JSON responses, as well as the &lt;a class="reference external" href="http://www.servicedenuages.fr/en/pagination-continuation-token"&gt;pagination
of lists&lt;/a&gt;, or the syntax for
filtering and sorting of resources via the
&lt;a class="reference external" href="https://en.wikipedia.org/wiki/Query_string"&gt;querystring&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Timestamps&lt;/strong&gt;: A revision counter that is auto-incremented with every write
operation in a collection.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Synchronisation&lt;/strong&gt;: Levers to retrieve and send changes to the data (without
loss or collision) using timestamps.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Permissions&lt;/strong&gt;: Specifically, user-level permissions on a collection or a
record. (&lt;em&gt;This is a work in progress&lt;/em&gt;) &lt;a class="footnote-reference" href="#id3" id="id1"&gt;[1]&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Batch operations&lt;/strong&gt;: A URL that accepts a series of JSON-formatted requests
and provides the response(s).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;From an operational perspective we looked at the following:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;Version control&lt;/strong&gt;: The cohabitation of multiple versions in production
along with alerts in the headers for versions which are end-of-life.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Deferred requests&lt;/strong&gt;: Client headers that can be activated during periods of
maintenance or heavy usage - the idea being to help save the server from
extraneous load.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Error channel&lt;/strong&gt;: All errors returned by the server have the same JSON
format and a specific identifier.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Utilities&lt;/strong&gt;: Various URLs that expose select metadata, public settings, and
other highly monitorable information (to keep your local sysadmin happy).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The Cliquet protocol is thus a compilation of:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Best practices for HTTP APIs (it's what we do for a living, after all);&lt;/li&gt;
&lt;li&gt;Advice from senior system administrators whose jobs it is to maintain
services for the many millions of Firefox users;&lt;/li&gt;
&lt;li&gt;Feedback from the &lt;em&gt;Firefox Sync&lt;/em&gt; team regarding concurrency management and
"offline-first" design.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Want to know more? No problem since it's &lt;a class="reference external" href="http://cliquet.readthedocs.org/en/latest/api/index.html"&gt;documented in great detail&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In an ideal world this protocol would be versioned and formalised in an RFC.
Perhaps there would even be several implementations in different languages.
&lt;a class="footnote-reference" href="#id4" id="id2"&gt;[2]&lt;/a&gt;&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id3" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;See our dedicated article on &lt;a class="reference external" href="http://www.servicedenuages.fr/en/handling-permissions"&gt;permissions in Cliquet&lt;/a&gt;.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id4" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id2"&gt;[2]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Bear in mind that we're a very small team!&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="the-toolkit"&gt;
&lt;h2&gt;The Toolkit&lt;/h2&gt;
&lt;div class="section" id="technical-choices"&gt;
&lt;h3&gt;Technical Choices&lt;/h3&gt;
&lt;p&gt;Cliquet, the protocol, is currently implemented in Python (&lt;em&gt;2.7, 3.4+, pypy&lt;/em&gt;)
with &lt;a class="reference external" href="http://trypyramid.com/"&gt;Pyramid&lt;/a&gt; &lt;a class="footnote-reference" href="#id6" id="id5"&gt;[3]&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Pyramid&lt;/strong&gt; is a web framework that is responsible for all things HTTP; it
is usable by projects of all sizes, great and small.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Cornice&lt;/strong&gt; is an extension for Pyramid written by Alexis and Tarek that
consists of reusable &lt;em&gt;boilerplate&lt;/em&gt; code. The goal here is to avoid reinventing
the wheel each time when building a REST API with Pyramid. Cornice handles
the plumbing for things like HTTP verbs and methods, header validation,
content negotiation, HTTP return codes, CORS headers, JSON schema validation,
and so forth.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Cliquet&lt;/strong&gt;, in turn, uses both Pyramid and Cornice to implement the protocol
and provide the necessary abstractions; both remain available for expanding
and extending from what comes in the box.&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id6" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id5"&gt;[3]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;We started with an implementation using &lt;em&gt;Python-Eve&lt;/em&gt; (Flask) but we weren't
satisified with the API configuration process - too much hand-waving and
black magic for our taste.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="concepts"&gt;
&lt;h3&gt;Concepts&lt;/h3&gt;
&lt;p&gt;Conceptually the toolkit reflects the protocol - there are some interesting
additional elements, however:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;Backends&lt;/strong&gt;: Abstractions for storage, caching, and permissions (ex.
&lt;em&gt;PostgreSQL, Redis, in-memory, etc.&lt;/em&gt;)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Monitoring&lt;/strong&gt;: JSON-formatted logs and real-time instrumentation (StatsD)
to keep tabs on performance and health.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Configuration&lt;/strong&gt;: The configuration itself can be loaded from environment
variables or the &lt;tt class="docutils literal"&gt;.ini&lt;/tt&gt; file - or a combination of both.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Flexibility&lt;/strong&gt;: Most of the components can be turned on or off (or
substituted completely) via the configuration alone.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Profiling&lt;/strong&gt;: Built-in development utilities to help find &lt;a class="reference external" href="https://en.wiktionary.org/wiki/bottleneck"&gt;bottlenecks&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;img alt="Cliquet concepts" class="align-center" src="http://www.servicedenuages.fr/en/../images/cliquet-concepts.png" style="width: 500px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;By proportion, the number of lines of code that are necessary to support REST
outweighs that of any other component in Cliquet. This is a feature; Cliquet
provides a wide range of functionality and can therefore be used in any
number of contexts (even without manipulating data).&lt;/p&gt;
&lt;p&gt;The primary objective of the toolkit is aid the developer in building their
application with a minimum of fuss. You mix and match only what you need, and
every component is guaranteed to be production-ready.&lt;/p&gt;
&lt;p&gt;For example, the persistence furnished by default is &lt;em&gt;schemaless&lt;/em&gt; (e.g. JSONB)
but there's no reason a relational storage model couldn't be implemented. Since
all of the moving parts can be replaced directly via the configuration, it's
entirely feasible to extend Cliquet with business logic or other exotic
elements. We've got even more ideas in the "ecosystem" portion of &lt;a class="reference external" href="http://cliquet.readthedocs.org/en/latest/ecosystem.html"&gt;our
documentation&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In a few weeks well be introducing the idea of "events" (or "signals")
which will allow plugins to interface in a much cleaner way.&lt;/p&gt;
&lt;p&gt;We put a high value on code &lt;em&gt;readability&lt;/em&gt;, as well as the importance of
patterns, tests, and documentation. If you have any feedback, suggestions,
accolades, or criticisms, don't hesitate to &lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/issues"&gt;let us know&lt;/a&gt;!&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="cliquet-in-action"&gt;
&lt;h2&gt;Cliquet in Action!&lt;/h2&gt;
&lt;p&gt;We wrote a &lt;a class="reference external" href="http://cliquet.readthedocs.org/en/latest/quickstart.html"&gt;quickstart guide&lt;/a&gt; that requires
no knowledge of &lt;em&gt;Pyramid&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Here are some examples to illustrate how straightforward Cliquet can be!&lt;/p&gt;
&lt;div class="section" id="step-1"&gt;
&lt;h3&gt;Step 1&lt;/h3&gt;
&lt;p&gt;Activate Cliquet:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;cliquet&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pyramid.config&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Configurator&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;global_config&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;config&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Configurator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;cliquet&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;'1.0'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;make_wsgi_app&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;From here, most of the features of Cliquet are active and ready to be used.&lt;/p&gt;
&lt;p&gt;For example, the &lt;em&gt;hello&lt;/em&gt; (&lt;tt class="docutils literal"&gt;/v1/&lt;/tt&gt;) or &lt;em&gt;monitoring&lt;/em&gt; (&lt;tt class="docutils literal"&gt;/v1/__heartbeat__&lt;/tt&gt;)
URLs, but also the storage and cache backends that are available in the classic
views in either Pyramid or Cornice.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="step-2"&gt;
&lt;h3&gt;Step 2&lt;/h3&gt;
&lt;p&gt;Add some views:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;global_config&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;config&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Configurator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;cliquet&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;'1.0'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;scan&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"myproject.views"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;make_wsgi_app&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The first step in defining a CRUD resource is to define the schema with
Colander:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;cliquet&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;schema&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;BookmarkSchema&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;schema&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ResourceSchema&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;schema&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;URL&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="nd"&gt;@resource.register&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Bookmark&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;BaseResource&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;mapping&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;BookmarkSchema&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;From here, the CRUD resource is available at &lt;tt class="docutils literal"&gt;/v1/bookmarks&lt;/tt&gt; with all the
synchronisation, filtering, sorting, paging, and timestamp features ready to
go. By default the records are private (per user).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="err"&gt;http&lt;/span&gt; &lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="s2"&gt;"http://localhost:8000/v1/bookmarks"&lt;/span&gt;
&lt;span class="err"&gt;HTTP/&lt;/span&gt;&lt;span class="mf"&gt;1.1&lt;/span&gt; &lt;span class="mi"&gt;200&lt;/span&gt; &lt;span class="err"&gt;OK&lt;/span&gt;
&lt;span class="err"&gt;...&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nt"&gt;"data"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
        &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nt"&gt;"url"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"http://cliquet.readthedocs.org"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="nt"&gt;"id"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"cc103eb5-0c80-40ec-b6f5-dad12e7d975e"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="nt"&gt;"last_modified"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1437034418940&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="step-3"&gt;
&lt;h3&gt;Step 3&lt;/h3&gt;
&lt;p&gt;There's lots of room to change things up, such as the URLs and HTTP verbs, or
even modifying the fields before they're saved.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nd"&gt;@resource.register&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;collection_path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;'/user/bookmarks'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                   &lt;span class="n"&gt;record_path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;'/user/bookmarks/{{id}}'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                   &lt;span class="n"&gt;collection_methods&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'GET'&lt;/span&gt;&lt;span class="p"&gt;,))&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Bookmark&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;BaseResource&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;mapping&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;BookmarkSchema&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;process_record&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;old&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;old&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;'device'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="n"&gt;old&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;'device'&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
            &lt;span class="n"&gt;device&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'User-Agent'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;'device'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;device&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;new&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For more information, see the &lt;a class="reference external" href="http://cliquet.readthedocs.org/en/latest/reference/resource.html"&gt;resource documentation&lt;/a&gt; .&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="step-4-optional"&gt;
&lt;h3&gt;Step 4 (optional)&lt;/h3&gt;
&lt;p&gt;Let's try using Cliquet &lt;em&gt;abstractions&lt;/em&gt; in a Cornice &lt;em&gt;view&lt;/em&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;cliquet&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Service&lt;/span&gt;

&lt;span class="n"&gt;score&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Service&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;"score"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;'/score/{game}'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="n"&gt;description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;"Store game score"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="nd"&gt;@score.post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;schema&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ScoreSchema&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;post_score&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;collection_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;'scores-'&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;match_dict&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;'game'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;user_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;authenticated_userid&lt;/span&gt;
    &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;validated&lt;/span&gt;  &lt;span class="c"&gt;# c.f. Cornice.&lt;/span&gt;

    &lt;span class="n"&gt;storage&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;registry&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;storage&lt;/span&gt;
    &lt;span class="n"&gt;record&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;storage&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;collection_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="feedback"&gt;
&lt;h2&gt;Feedback&lt;/h2&gt;
&lt;p&gt;Have something you'd like to say? Want to get involved? Great! We love
community contributions and would be glad to help you get started.&lt;/p&gt;
&lt;div class="section" id="areas-for-improvement"&gt;
&lt;h3&gt;Areas for improvement&lt;/h3&gt;
&lt;p&gt;We're quite proud of what we've built in a relatively short time frame, and as
we noted in a &lt;a class="reference external" href="{filename/2015.07.whistler-use-cases-en.rst}"&gt;previous article&lt;/a&gt;, there's a lot of potential
just waiting to be tapped. Nonetheless, we are aware of a few areas where we
could improve things - maybe you'd like to help?&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;API Documenatation&lt;/strong&gt;: Right now we don't have a good solution for a project
based on Cliquet to easily integrate all of the API documentation.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Documentation in general&lt;/strong&gt;: It's difficult to write, organise, and maintain
documentation, especially when it's aimed at a general public that runs the
gamut from absolute beginner to expert. We are victims of the "&lt;a class="reference external" href="https://en.wikipedia.org/wiki/Curse_of_knowledge"&gt;curse of
knowledge&lt;/a&gt;".&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Protocol&lt;/strong&gt;: At some point we're going to have to properly version the
protocol, which means making a division within versions of Cliquet itself;
this will be necessary if we want to move the ecosystem forward.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Conservatism&lt;/strong&gt;: We're fans of stability and robustness, but we don't live
in a vacuum and must therefore sometimes bend to the realities of the real
world. Moving forward with Python 3 is a part of this (async is a good
target).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Releases&lt;/strong&gt;: The flip side of factoring. Occasionally we add features or
otherwise evolve the toolkit as a response to the requirements of a specific
project. As a result, we end up having to do waterfall-style project
releases.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="common-questions"&gt;
&lt;h3&gt;Common Questions&lt;/h3&gt;
&lt;div class="section" id="why-python"&gt;
&lt;h4&gt;Why Python?&lt;/h4&gt;
&lt;p&gt;The simple answer is that we like Python! Seriously though, the fact of the
matter was that our timetable was pretty tight - we didn't have time to learn a
new language.&lt;/p&gt;
&lt;p&gt;That and the fact the whole time had just spent on a year on a Node.js project
from which we needed to recover.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="why-not-django"&gt;
&lt;h4&gt;Why not Django?&lt;/h4&gt;
&lt;p&gt;We definitely considered it, especially given the number of fans of the &lt;em&gt;Django
REST Framework&lt;/em&gt; in the team. Ultimately we decided that the flexibility of
Pyramid's lightweight framework was a better fit.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="why-not-an-async-framework-in-python-3"&gt;
&lt;h4&gt;Why not an async framework in Python 3?&lt;/h4&gt;
&lt;p&gt;At the time, the Mozilla Operations team supported only Python 2.7 in
production (much to our chagrin).&lt;/p&gt;
&lt;p&gt;For Reading List &lt;a class="reference external" href="https://github.com/mozilla-services/readinglist/blob/1.7.0/readinglist/__init__.py#L19-L26"&gt;we activated gevent&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;That said, since our only goal is to implement a well-defined protocol, we may
some day write Cliquet in &lt;em&gt;aiohttp&lt;/em&gt; or &lt;em&gt;Go&lt;/em&gt; if the opportunity presents itself.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="why-not-json-api"&gt;
&lt;h4&gt;Why not JSON-API?&lt;/h4&gt;
&lt;p&gt;Like we mentioned in a &lt;a class="reference external" href="http://www.servicedenuages.fr/en/apidays-barcelona-retours"&gt;previous post (fr)&lt;/a&gt;, JSON-API is a specification that
touches on a lot of what we wanted - we didn't know about it when we started
with our own protocol. Since our proposition is pretty minimalist in
comparison, the idea of integrating JSON-API hasn't progressed beyond the
&lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/issues/254"&gt;discussion phase&lt;/a&gt;
yet.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="is-cliquet-a-rest-framework-for-pyramid"&gt;
&lt;h4&gt;Is Cliquet a REST framework for Pyramid?&lt;/h4&gt;
&lt;p&gt;No.&lt;/p&gt;
&lt;p&gt;Beyond the CRUD resources classes in Cliquet (which implement a highly
specific protocol), you must use Cornice or Pyramid directly.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="is-cliquet-sufficiently-generic-for-non-mozilla-projects"&gt;
&lt;h4&gt;Is Cliquet sufficiently generic for non-Mozilla projects?&lt;/h4&gt;
&lt;p&gt;Yes!&lt;/p&gt;
&lt;p&gt;It's designed from the ground up such that every component can be
turned on or off, or substituted entirely, right from the configuration file
(or from the environment).&lt;/p&gt;
&lt;p&gt;If the combination of HTTP, JSON, and CRUD resources satisfies your use case,
then Cliquet is a pretty safe bet for you new application. Combined with
a design based on production best practices and handy abstractions, Cliquet
offers a straightforward way to quickly get up and running with a Pyramid /
Cornice webapp.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="do-the-json-resources-support-complex-relational-models"&gt;
&lt;h4&gt;Do the JSON resources support complex relational models?&lt;/h4&gt;
&lt;p&gt;The built-in persistence layer is relatively simple and should fit almost any
use case where the data have no particular relationship; however, you could
take advantage of the full power of the protocol by using a custom Collection
class to manage these relations.&lt;/p&gt;
&lt;p&gt;As an aside, this might be a good excuse to implement the protocol within the
Django REST framework. :-)&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="is-it-possible-to-do-xyz"&gt;
&lt;h4&gt;Is it possible to do XYZ?&lt;/h4&gt;
&lt;p&gt;We'd like to prepare a series of recipes and tutorials, but for that, we need
to collect idea from the community. Some potential ideas include:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Hooks for GitHub authentication.&lt;/li&gt;
&lt;li&gt;Modifying the JSON logging format.&lt;/li&gt;
&lt;li&gt;Storing mapping (topographical, geo, etc) data.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="can-cliquet-deal-with-files"&gt;
&lt;h4&gt;Can Cliquet deal with files?&lt;/h4&gt;
&lt;p&gt;No. Well, &lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/issues/236"&gt;not yet&lt;/a&gt;
at least.&lt;/p&gt;
&lt;p&gt;We're holding off until we have a concrete need for this functionality at
Mozilla. Should file storage become a thing, it would likely use &lt;a class="reference external" href="http://remotestorage.io/"&gt;Remote
Storage&lt;/a&gt; in order to hook into that
growing ecosystem.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="will-feature-xyz-be-implemented"&gt;
&lt;h4&gt;Will feature XYZ be implemented?&lt;/h4&gt;
&lt;p&gt;Cliquet is already quite well stocked with features. In general, rather than
implementing new functionality, we'd rather work on ensuring that the base
abstractions and extension mechanisms are robust enough to allow for a diverse
plugin-style ecosystem.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</summary></entry><entry><title>Summer Perspectives</title><link href="http://www.servicedenuages.fr/en/summer-perspectives" rel="alternate"></link><updated>2015-07-07T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-07-07:en/summer-perspectives</id><summary type="html">&lt;div class="note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;Translated from the French by &lt;a class="reference external" href="https://dark.ca/"&gt;Dan Phrawzty&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Mozilla has a tradition of "work weeks" whereby the members of our many distributed teams get together in a single physical location a few times per year; occasionally these work weeks involve the entire company, as was the case most recently in &lt;a class="reference external" href="http://www.openstreetmap.org/node/268148288#map=4/50.12/-122.95"&gt;Whistler, BC, Canada&lt;/a&gt;.&lt;/p&gt;
&lt;img alt='"All Hands" talk about Lego, by @davidcrob - CC0' class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-talks.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;It was a great opportunity for our team to come together, to share our vision and ideas concerning data storage, and to collect use-cases for &lt;a class="reference external" href="https://kinto.readthedocs.org"&gt;Kinto&lt;/a&gt;.&lt;/p&gt;
&lt;div class="section" id="workshops-and-self-promotion"&gt;
&lt;h2&gt;Workshops and Self-Promotion&lt;/h2&gt;
&lt;p&gt;Nicolas presented &lt;a class="reference external" href="https://github.com/mozilla-services/kinto.js"&gt;Kinto.js&lt;/a&gt; at a dedicated workshop in Whistler, the content of which now forms a &lt;a class="reference external" href="http://kintojs.readthedocs.org/en/latest/tutorial/"&gt;introductory tutorial&lt;/a&gt;. The resulting application, simple though it appears, is a great way to learn the basic concepts behind synchronisation in Kinto. Furthermore, we didn't even need to set up a server - Rémy set one up that &lt;a class="reference external" href="https://kinto.dev.mozaws.net/v1/"&gt;resets itself every day&lt;/a&gt;!&lt;/p&gt;
&lt;p&gt;As an aside, we chose to use Vanilla-JS for two reasons: firstly because it allowed us to avoid the framework wars, but also because it proves that we can do so much more with HTML5 and ES6 than was possible a few years ago.&lt;/p&gt;
&lt;p&gt;Furthermore, this small workshop helped us to realise that we still have large gaps in our documentation, particularly as regards the eco-system and the long-term, global vision for our family of projects. This is an area where we have resolved to do better.&lt;/p&gt;
&lt;img alt="Kinto.js workshop - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-workshop.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;div class="section" id="mozilla-payments"&gt;
&lt;h2&gt;Mozilla Payments&lt;/h2&gt;
&lt;p&gt;As noted in a &lt;a class="reference external" href="http://www.servicedenuages.fr/la-gestion-des-permissions"&gt;previous blog post&lt;/a&gt; we developed a permissions model which allows Kinto fulfill the the requirements of payment and subscription tracker (our fist use-case).&lt;/p&gt;
&lt;p&gt;For this project, Kinto is going to be used by a Django app via a Python client.&lt;/p&gt;
&lt;p&gt;Now that the development is done we have to deliver - that means integrating, hosting, and really pushing the usefulness of the stack. The solution is should be ready to go by the end of the year.&lt;/p&gt;
&lt;div class="section" id="coming-soon"&gt;
&lt;h3&gt;Coming Soon&lt;/h3&gt;
&lt;p&gt;Following the recent successful implementation of a permissions model, we'd like to take some time out to implement a feature that is important to us: allowing read access to &lt;em&gt;shared&lt;/em&gt; records in a collection. If this is interesting to you, feel free to follow &lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/issues/354"&gt;the issue&lt;/a&gt; or (better yet) contribute a patch!&lt;/p&gt;
&lt;img alt="Whistler Alta Lake - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-lake.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="firefox-os-and-storage"&gt;
&lt;h2&gt;Firefox OS and Storage&lt;/h2&gt;
&lt;p&gt;We've collaborated frequently with the Firefox OS team over the years, notably regarding the &lt;a class="reference external" href="https://github.com/mozilla-services/msisdn-gateway"&gt;MISISDN Gateway&lt;/a&gt; (basically a way to link BrowserID and SMS together) and &lt;a class="reference external" href="https://github.com/mozilla-services/loop-server"&gt;Firefox Hello&lt;/a&gt;.&lt;/p&gt;
&lt;div class="section" id="in-app-sync"&gt;
&lt;h3&gt;In-App Sync&lt;/h3&gt;
&lt;p&gt;Kinto as a simple solution for synchronising data in Firefox OS? Nice! We've had this partnership in mind for some time (remember &lt;a class="reference external" href="http://daybed.readthedocs.org/"&gt;Daybed&lt;/a&gt;?), and now we've got a great opportunity at our fingertips.&lt;/p&gt;
&lt;p&gt;We'll need to clearly and plainly lay out the limitations and simplistic models inherent in our solution (notably regarding concurrency management), but we believe that it fits the use-case fairly well, so it should not disapoint. :)&lt;/p&gt;
&lt;p&gt;We're particularly motivated as both &lt;a class="reference external" href="https://github.com/daleharvey"&gt;Dale Harvey&lt;/a&gt; (one of the authors of &lt;a class="reference external" href="http://pouchdb.com/"&gt;PouchDB&lt;/a&gt;) and &lt;a class="reference external" href="https://github.com/michielbdejong"&gt;Michel de Jong&lt;/a&gt; (one of the authors of &lt;a class="reference external" href="http://remotestorage.io/"&gt;Remote Storage&lt;/a&gt;) have given us plenty of encouragement from an early stage.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="cut-the-rope"&gt;
&lt;h3&gt;Cut The Rope&lt;/h3&gt;
&lt;p&gt;Kinto is likely to be used to synchronise the configuration settings and scores of the very popular game &lt;a class="reference external" href="https://marketplace.firefox.com/app/cut-the-rope/"&gt;Cut The Rope&lt;/a&gt;. It'll be good to have a practical use-case on such a visible platform.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="syncto"&gt;
&lt;h3&gt;Syncto&lt;/h3&gt;
&lt;p&gt;&lt;a class="reference external" href="https://docs.services.mozilla.com/storage/apis-1.5.html"&gt;Firefox Sync&lt;/a&gt; is what enables synchronisation between Firefox (favourites, extensions, browser history, etc.) and many other targets in an encrypted fashion. The current Javascript client implementation is relatively complex and, frankly, somewhat dated (the proposed re-write has yet to occur).&lt;/p&gt;
&lt;p&gt;We'd like to implement a bridge between &lt;em&gt;Kinto&lt;/em&gt; and &lt;em&gt;Firefox Sync&lt;/em&gt; via &lt;em&gt;Kinto.js&lt;/em&gt; - which is more simple and more modern than the existing reference client - in order to store synced data in IndexedDB. On the server side, we feel that this shouldn't be too hard since our project is itself inspired by Sync's proven protocol model; from a client perspective, most of the work will be in plumbing crypto into BrowserID authentication.&lt;/p&gt;
&lt;p&gt;Alexis jumped at the chance to start work on a &lt;a class="reference external" href="https://github.com/mozilla-services/syncclient"&gt;Python Firefox Sync client&lt;/a&gt; which will serve as the base for any future service.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="cloud-storage"&gt;
&lt;h3&gt;Cloud Storage&lt;/h3&gt;
&lt;p&gt;Eden Chung and Sean Lee did a presentation on their advancements regarding the integration of remote storage services (notably DropBox and Baidu Yun) in Firefox OS. Their current proof-of-concept is based on &lt;a class="reference external" href="https://en.wikipedia.org/wiki/Filesystem_in_Userspace"&gt;FUSE&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We were also thinking about introducing the idea of attachments in Kinto by implementing the &lt;a class="reference external" href="https://tools.ietf.org/html/draft-dejong-remotestorage-05"&gt;remote storage specification&lt;/a&gt;; however, for the moment our existing use-cases just aren't calling for it.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id2"&gt;
&lt;h3&gt;Coming Soon&lt;/h3&gt;
&lt;p&gt;In addition to the work that we've already done on the server side, we're going to have to deal with concurrency management in our Javascript client in order to allow simultaneous writes and background synchronisation.&lt;/p&gt;
&lt;p&gt;We are always looking for feedback - and, of course, code contributions - on both the &lt;a class="reference external" href="https://github.com/mozilla-services/kinto/"&gt;server&lt;/a&gt; and &lt;a class="reference external" href="https://github.com/mozilla-services/kinto.js/"&gt;client&lt;/a&gt;!&lt;/p&gt;
&lt;img alt="Firefox OS Cloud Storage Presentation - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-cloud-storage.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="firefox-application-content"&gt;
&lt;h2&gt;Firefox Application Content&lt;/h2&gt;
&lt;p&gt;The Firefox development and release process is currently based on a six-week cycle. One of the objectives is to decouple certain specific content elements (such as safety rules, dictionaries and translations, etc.) from these relatively long cycles &lt;a class="footnote-reference" href="#id4" id="id3"&gt;[1]&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The proposed solution is versioned, read-only JSON and binary blobs that can be synchronised with live browsers. There are already a number of tools to manage this sort of thing (examples include &lt;a class="reference external" href="https://wiki.mozilla.org/Balrog"&gt;Balrog&lt;/a&gt; and &lt;a class="reference external" href="https://github.com/mozilla-services/shavar"&gt;Shavar&lt;/a&gt;), but for the moment no choice has been made. During conversations with the team in charge of this project it became evident that Kinto could be useful here too - which is motivating us even more to evolve our project!&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id4" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id3"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;The good news is that all the existing 3rd-party functionality will be
revived in the form of add-ons.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;img alt="Landscape - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-landscape.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;div class="section" id="awesome-bar"&gt;
&lt;h2&gt;Awesome Bar&lt;/h2&gt;
&lt;p&gt;The &lt;em&gt;Firefox Labs&lt;/em&gt; team, best known for raising red pandas in &lt;a class="reference external" href="https://i.imgur.com/NPG7CxB.gif"&gt;test tubes&lt;/a&gt;, is interested in our solution as well, notably as regards the evolution of the &lt;a class="reference external" href="https://support.mozilla.org/en-US/kb/awesome-bar-search-firefox-bookmarks-history-tabs"&gt;Awesome Bar&lt;/a&gt; which would meld URLs, browser history, and search functions.&lt;/p&gt;
&lt;p&gt;We can't say too much right now, but the aforementioned shared collections feature in &lt;em&gt;Kinto&lt;/em&gt; would fit so very nicely into the future of the Firefox browser. :)&lt;/p&gt;
&lt;div class="section" id="id6"&gt;
&lt;h3&gt;Coming Soon&lt;/h3&gt;
&lt;p&gt;In all likelihood we will need to implement indexing and full-text searching (read: Elasticsearch) before the end of the year. This fits nicely into our roadmap since it's something that we had in Daybed already.&lt;/p&gt;
&lt;img alt="Firefox Labs Meeting - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-labs.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="browser-html"&gt;
&lt;h2&gt;Browser.html&lt;/h2&gt;
&lt;p&gt;The Search team has been exploring and extending the very notion of a platform, and is currently working on implementing a web browser in Javascript and HTML5 with &lt;a class="reference external" href="https://facebook.github.io/react/"&gt;React&lt;/a&gt;, the result of which is affectionatly known as &lt;a class="reference external" href="https://github.com/mozilla/browser.html"&gt;browser.html&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Kinto aligns very well with the needs of that project as regards the synchronisation of user data. This could be as simple as a replication of Sync itself, but it could also be something more interesting, such as entire collections of any arbitrary data - for example, browser preferences, or an Alexa-top-500-style mechanism that would allow URL completion without the need to send a search request.&lt;/p&gt;
&lt;p&gt;But why stop with just the local browser? We could synchronise entire React states between peripherals, thus allowing a seamless browser experience across every device!&lt;/p&gt;
&lt;div class="section" id="id8"&gt;
&lt;h3&gt;Coming Soon&lt;/h3&gt;
&lt;p&gt;If Browser.html must store navigation data, we believe that it should do so using strong encryption directly in the Javascript client. Luckily we're not the only ones thinking about this, and there are already &lt;a class="reference external" href="http://www.w3.org/TR/WebCryptoAPI/"&gt;several possible standards&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;To avoid pinging the server at regular intervals in order to synchronise the changes (effectively DDoS'ing ourselves!), the introduction of &lt;a class="reference external" href="https://w3c.github.io/push-api/"&gt;push notifications&lt;/a&gt; seems like a natural choice. This would be the final building block in our quest to build a complete "Mobile / Web backed as a service".&lt;/p&gt;
&lt;img alt="Roadmap - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-roadmap.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;We're in pretty much the ideal situation right now: &lt;a class="reference external" href="https://github.com/mozilla-services/kinto/wiki/Roadmap"&gt;everything&lt;/a&gt; that we've imagined, worked on, prototyped, and shipped corresponds to the needs and desires of a number of teams at Mozilla.&lt;/p&gt;
&lt;p&gt;Our challenges ahead are:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Co-ordinate with the other teams efficiently.&lt;/li&gt;
&lt;li&gt;Avoid &lt;a class="reference external" href="https://i.imgur.com/jeFYGQ5.jpg"&gt;disappointment&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Maintain a high level of productivity.&lt;/li&gt;
&lt;li&gt;Continue to improve and promote our solutions.&lt;/li&gt;
&lt;li&gt;Focus on quick wins that move us forward.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Finally, we will work to encourage meaningful community contributions to help us build a free, generic, simple, and self-hostable solution for storing data on the web.&lt;/p&gt;
&lt;img alt="Friday Night Party - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-top-roof.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
</summary></entry><entry><title>Achievement unlocked</title><link href="http://www.servicedenuages.fr/en/kinto-1.0" rel="alternate"></link><updated>2015-06-17T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-06-17:en/kinto-1.0</id><summary type="html">&lt;p&gt;Today we released Cliquet 2.0 &lt;a class="footnote-reference" href="#id5" id="id1"&gt;[1]&lt;/a&gt; and Kinto 1.0 &lt;a class="footnote-reference" href="#id6" id="id2"&gt;[2]&lt;/a&gt; (a.k.a Cloud Storage).&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://kinto.readthedocs.org/en/latest/"&gt;Kinto&lt;/a&gt; is a service to
store, synchronize and share arbitrary data attached to a Firefox Account.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://cliquet.readthedocs.org/en/latest/"&gt;Cliquet&lt;/a&gt; is a toolkit to
ease the implementation of HTTP micro-services, such as data-driven REST APIs
with synchronization needs.&lt;/p&gt;
&lt;p&gt;You can read more about our rationale for building this solution at
&lt;a class="reference external" href="http://www.servicedenuages.fr/eco-systeme-et-stockage-generique-en.html"&gt;http://www.servicedenuages.fr/eco-systeme-et-stockage-generique-en.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Both projects received a lot of diligence during the last months. Even
though most of the work we had done for Reading List could be
used, we rebuilt many parts and introduced some long awaited features,
like permissions management.&lt;/p&gt;
&lt;p&gt;Of course, exactly like when you refurbish a ceiling at home, we can't
resist to see loads of things that shall still be improved! Especially
about documentation and performance :)&lt;/p&gt;
&lt;p&gt;We can already foresee how the ecosystem will look like, and it's
promising. There is already a JavaScript client &lt;a class="footnote-reference" href="#id7" id="id3"&gt;[3]&lt;/a&gt;, which aims to
synchronize browser local data with a Kinto instance.&lt;/p&gt;
&lt;p&gt;We strongly welcome any feedback, be it about the code, the
documentation or security aspects of the solution. If you wish to reach
to us, you can use the #storage channel of the Mozilla IRC network.&lt;/p&gt;
&lt;p&gt;And, this is just the beginning! Future plans are described in our road
map &lt;a class="footnote-reference" href="#id8" id="id4"&gt;[4]&lt;/a&gt;.&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id5" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Cliquet is a toolkit to ease the implementation of HTTP
microservices, such as data-driven REST APIs —  &lt;a class="reference external" href="https://cliquet.readthedocs.org"&gt;https://cliquet.readthedocs.org&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id6" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id2"&gt;[2]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Kinto is a server allowing you to store and synchronize arbitrary data,
attached to your Firefox account. — &lt;a class="reference external" href="https://kinto.readthedocs.org"&gt;https://kinto.readthedocs.org&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id7" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id3"&gt;[3]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Cliquetis, the javascript library to consume the Kinto HTTP API —
&lt;a class="reference external" href="https://github.com/mozilla-services/cliquetis"&gt;https://github.com/mozilla-services/cliquetis&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id8" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id4"&gt;[4]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Kinto roadmap: &lt;a class="reference external" href="https://github.com/mozilla-services/kinto/wiki/roadmap"&gt;https://github.com/mozilla-services/kinto/wiki/roadmap&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</summary></entry><entry><title>Handling permissions</title><link href="http://www.servicedenuages.fr/en/handling-permissions" rel="alternate"></link><updated>2015-05-12T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-05-12:en/handling-permissions</id><summary type="html">&lt;p&gt;When creating a generic data storage (Kinto), permissions handling is one of
the big challenges: who should get access to what, and how should we define
these rules?&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;tl;dr: Some feedback about the permissions vocabulary and our ideas about how
to implement permissions management in a generic data storage system&lt;/strong&gt;&lt;/p&gt;
&lt;div class="section" id="the-problem-at-hand"&gt;
&lt;h2&gt;The problem at hand&lt;/h2&gt;
&lt;p&gt;The problem we're facing is simple: data is stored online and we need a way to
share this data with other people.&lt;/p&gt;
&lt;p&gt;Looking at the use cases, it's possible to split our users in two categories:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;End users (you);&lt;/li&gt;
&lt;li&gt;Applications which interact on their behalf.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Different parties don't have the same rights: some should be able to read,
others should write, yet another should be able to create new records, and all
this permission handling should be fine-grained: it should be possible to read
one record but not the other, for instance.&lt;/p&gt;
&lt;p&gt;We started from the fact that no available solution was offering an appealing
solution to these needs.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="a-vocabulary-problem"&gt;
&lt;h2&gt;A vocabulary problem&lt;/h2&gt;
&lt;p&gt;The principal problem that got in our way during our thinking was the
vocabulary.&lt;/p&gt;
&lt;div class="section" id="principals"&gt;
&lt;h3&gt;Principals&lt;/h3&gt;
&lt;p&gt;A &lt;em&gt;principal&lt;/em&gt;, is an entity that can be authenticated by a computer system.
It is the actor who does the action. &lt;a class="footnote-reference" href="#id2" id="id1"&gt;[1]&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;It could either be someone, a computer, a service or a group of any of such
things. This is conceptually wider than the classical "user id*".&lt;/p&gt;
&lt;p&gt;Permissions are then associated to these &lt;em&gt;principals&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;For instance, a user is identified in an unique way when he connects to the
authentication system, which role is to define a list of &lt;em&gt;principals&lt;/em&gt; for the
authenticating user.&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id2" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;To read more about &lt;em&gt;principals&lt;/em&gt; :
&lt;a class="reference external" href="https://en.wikipedia.org/wiki/Principal_%28computer_security%29"&gt;https://en.wikipedia.org/wiki/Principal_%28computer_security%29&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="the-difference-between-a-role-and-a-group"&gt;
&lt;h3&gt;The difference between a role and a group&lt;/h3&gt;
&lt;p&gt;From scratch, it's not easy to precisely define the difference between these two
concepts which allow to associate permissions to a group of &lt;em&gt;principals&lt;/em&gt;. &lt;a class="footnote-reference" href="#id4" id="id3"&gt;[2]&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The difference is mainly semantic, but we can see a difference in the "direction"
of the relationship between these two concepts.&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;A role is a list of permissions associated to a &lt;em&gt;principal&lt;/em&gt;;&lt;/li&gt;
&lt;li&gt;A group is a list of &lt;em&gt;principals&lt;/em&gt; we can associate to a permission.&lt;/li&gt;
&lt;/ul&gt;
&lt;table class="docutils footnote" frame="void" id="id4" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id3"&gt;[2]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;More information at:
&lt;a class="reference external" href="http://stackoverflow.com/questions/7770728/group-vs-role-any-real-difference"&gt;http://stackoverflow.com/questions/7770728/group-vs-role-any-real-difference&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="the-difference-between-permission-acl-and-ace"&gt;
&lt;h3&gt;The difference between permission, ACL and ACE&lt;/h3&gt;
&lt;blockquote class="epigraph"&gt;
&lt;p&gt;An ACL is a list of Access Control Entry (ACE) enabling or disabling
acces rights to a person or a group.&lt;/p&gt;
&lt;p class="attribution"&gt;—&lt;a class="reference external" href="https://en.wikipedia.org/wiki/Access_Control_List"&gt;https://en.wikipedia.org/wiki/Access_Control_List&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;I would even say, in our case, "to a &lt;em&gt;principal&lt;/em&gt;". For instance:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;create_record: alexis,remy,tarek
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This ACE gives the &lt;tt class="docutils literal"&gt;create&lt;/tt&gt; permission on the &lt;tt class="docutils literal"&gt;record&lt;/tt&gt; object to the users
Tarek, Rémy and Alexis.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="permissions-delegation"&gt;
&lt;h2&gt;Permissions delegation&lt;/h2&gt;
&lt;p&gt;Imagine the following example, where Alice stores two types of data online:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;a list of contacts ;&lt;/li&gt;
&lt;li&gt;a list of tasks, which can be associated to her contacts.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Alice has all the rights on its data.&lt;/p&gt;
&lt;p&gt;However, she's using two applications which should have a restricted access:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;One application to handle contacts, to which she wants to delegate the entire
management: &lt;tt class="docutils literal"&gt;contacts:write&lt;/tt&gt; ;&lt;/li&gt;
&lt;li&gt;Another application to handle the tasks, to which she wants to delegate the
management of the tasks, and the reading of the contacts: &lt;tt class="docutils literal"&gt;contacts:read
tasks:write&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;She wants to prevent her contacts application to access the tasks and the tasks
app should not be able to update existing contacts, just eventually creating
new ones.&lt;/p&gt;
&lt;p&gt;She then needs a way to delegate some of her permissions to a third party (the
app).&lt;/p&gt;
&lt;p&gt;That's precisely the role of &lt;a class="reference external" href="http://tools.ietf.org/html/rfc6749#page-23"&gt;OAuth2 scopes&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;During the connection of a user, a window will ask her which access she wants
to give to the application that will act on her behalf.&lt;/p&gt;
&lt;p&gt;The service will then have access to these &lt;em&gt;scopes&lt;/em&gt; by looking at the
used authentication token. This information should be considered as a user
input (that is, we cannot trust it). It is what the user &lt;em&gt;wants&lt;/em&gt;, not what the
user &lt;em&gt;should have access to&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;It's possible that the user don't have access to the requested data. The
service should use two levels of permissions: the user ones, and the ones that
were delegated to the application.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="namespaces"&gt;
&lt;h2&gt;Namespaces&lt;/h2&gt;
&lt;p&gt;In our initial implementation of &lt;em&gt;Kinto&lt;/em&gt; (our generic data storage service),
the &lt;em&gt;namespace&lt;/em&gt; was implicit: stored data was necessarily tied to the connected
user.&lt;/p&gt;
&lt;p&gt;User data were then impossible to share.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Namespaces&lt;/em&gt; are a simple way to handle the data sharing problem.&lt;/p&gt;
&lt;p&gt;We chose to re-use the GitHub and BitBucket mode, which uses "organisations" as
&lt;em&gt;namespaces&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;In our case, it's possible to create "buckets", which are one of these
&lt;em&gt;namespaces&lt;/em&gt;. A bucket is a container for collections and user groups.&lt;/p&gt;
&lt;p&gt;ACLs on these collections can be given to certain groups of the bucket, and
directly to other &lt;em&gt;principals&lt;/em&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="our-api-proposal"&gt;
&lt;h2&gt;Our API proposal&lt;/h2&gt;
&lt;div class="section" id="manipulated-objects"&gt;
&lt;h3&gt;Manipulated objects&lt;/h3&gt;
&lt;p&gt;To handle permissions, we identified the following objects:&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="23%"&gt;&lt;/col&gt;
&lt;col width="77%"&gt;&lt;/col&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Object&lt;/th&gt;
&lt;th class="head"&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;bucket&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;We can see them as &lt;em&gt;namespaces&lt;/em&gt;. They allow to have
different collections having the same name but stored
in different &lt;em&gt;buckets&lt;/em&gt; so that data are distinct.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;collection&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;A list of records.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;record&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;A record from a collection&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;group&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;A group of principals&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;To define ACLs, there is a hierarchy: objects inherit the ACLs from their
parents.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;           +---------------+
           | Bucket        |
           +---------------+
    +-----&amp;gt;+ - id          +&amp;lt;---+
    |      | - permissions |    |
    |      +---------------+    |
    |                           |
    |                           |
    |                           |
    |                           |
    |                           |
+---+-----------+        +------+---------+
| Collection    |        | Group          |
+---------------+        +----------------+
| - id          |        |  - id          |
| - permissions |        |  - members     |
+------+--------+        |  - permissions |
       ^                 +----------------+
       |
       |
+------+---------+
| Record         |
+----------------+
|  - id          |
|  - data        |
|  - permissions |
+----------------+
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="permissions"&gt;
&lt;h3&gt;Permissions&lt;/h3&gt;
&lt;p&gt;For all of these objects, we identified the following permissions:&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="23%"&gt;&lt;/col&gt;
&lt;col width="77%"&gt;&lt;/col&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Permission&lt;/th&gt;
&lt;th class="head"&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;read&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;The permission to read the content of
the object and all its children.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;write&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;The permission to modify and
administration an object and all its
children objects. The &lt;em&gt;write&lt;/em&gt;
permission allows reading, modification
and deletion of objects, and the
handling of permissions on this object.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;create&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;The permission to create the specified
child object. For instance:
&lt;tt class="docutils literal"&gt;collections:create&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;To each specified permission on an object is associated a list of &lt;em&gt;principals&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;For the &lt;tt class="docutils literal"&gt;create&lt;/tt&gt; permission, we are forced to specify which child the
permission applies to since an object can have different kind of child nodes.
For instance: &lt;tt class="docutils literal"&gt;collections:create&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;groups:create&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;We don't have a &lt;cite&gt;delete&lt;/cite&gt; and &lt;cite&gt;update&lt;/cite&gt; permission so far, because we don't have
any use case which needs them. Whoever with the &lt;tt class="docutils literal"&gt;write&lt;/tt&gt; permission can also
delete a record.&lt;/p&gt;
&lt;p&gt;Permissions from an object are inherited from its parent. For instance,
a record created in a collection available to anyone will also be available to
anyone.&lt;/p&gt;
&lt;p&gt;Said differently, it's not possible that an object has a more restrictive
permission that its parent.&lt;/p&gt;
&lt;p&gt;Here is a complete list of permissions:&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="21%"&gt;&lt;/col&gt;
&lt;col width="32%"&gt;&lt;/col&gt;
&lt;col width="47%"&gt;&lt;/col&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Object&lt;/th&gt;
&lt;th class="head"&gt;Associated permissions&lt;/th&gt;
&lt;th class="head"&gt;Comment&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;Configuration
(.ini)&lt;/td&gt;
&lt;td&gt;&lt;cite&gt;buckets:create&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;&lt;em&gt;Principals&lt;/em&gt; who can create
a bucket are defined in the
service configuration (for
instance "authenticated users")&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="4"&gt;&lt;tt class="docutils literal"&gt;bucket&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;cite&gt;write&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;The "admin" permission for the
&lt;em&gt;bucket&lt;/em&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;read&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;The permission to read all the
content of all objects in the
&lt;em&gt;bucket&lt;/em&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;collections:create&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission to create
collections in the &lt;em&gt;bucket&lt;/em&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;groups:create&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission to create groups
in the &lt;em&gt;bucket&lt;/em&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="3"&gt;&lt;tt class="docutils literal"&gt;collection&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;cite&gt;write&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission to administrate all
objects in the collection.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;read&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission to consult all
objects in the collection.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;records:create&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission to create new
records in the collection.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;record&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;cite&gt;write&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission to modify or share
the record.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;read&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission to read the record.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;group&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;cite&gt;write&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission to administrate the
group.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;read&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission to know the members of
the group.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="id5"&gt;
&lt;h3&gt;&lt;em&gt;principals&lt;/em&gt;&lt;/h3&gt;
&lt;p&gt;Actors connecting to the storage service can authenticate themselves.&lt;/p&gt;
&lt;p&gt;They then receive a list of &lt;em&gt;principals&lt;/em&gt;:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;: the &lt;em&gt;principal&lt;/em&gt; given to all actors (authenticated or not);&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;: the &lt;em&gt;principal&lt;/em&gt; given to all authenticated actors;&lt;/li&gt;
&lt;li&gt;A &lt;em&gt;principal&lt;/em&gt; identifying the actor, for instance &lt;tt class="docutils literal"&gt;fxa:32aa95a474c984d41d395e2d0b614aa2&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In order to avoid identifiers collisions, the actor &lt;em&gt;principal&lt;/em&gt; is built from
the authentication type used (&lt;tt class="docutils literal"&gt;system&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;basic&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;ipaddr&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;hawk&lt;/tt&gt;,
&lt;tt class="docutils literal"&gt;fxa&lt;/tt&gt;) and the identifier.&lt;/p&gt;
&lt;p&gt;Depending the &lt;em&gt;bucket&lt;/em&gt; on which the action is taking place, the groups the user
is a member of are also added to her list of principals (e.g.
&lt;tt class="docutils literal"&gt;group:moderators&lt;/tt&gt;)&lt;/p&gt;
&lt;p&gt;So, if Bob connects with his &lt;em&gt;Firefox Account&lt;/em&gt; on the &lt;tt class="docutils literal"&gt;servicedenuages_blog&lt;/tt&gt;
bucket, on which he is a member of the &lt;tt class="docutils literal"&gt;moderators&lt;/tt&gt; group, he would have the
following list of principals:
&lt;tt class="docutils literal"&gt;Everyone, Authenticated, fxa:32aa95a474c984d41d395e2d0b614aa2, group:moderators&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;It's then possible to assign a permission to Bob by using one of these
&lt;em&gt;principals&lt;/em&gt;.&lt;/p&gt;
&lt;div class="note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;The &lt;tt class="docutils literal"&gt;&amp;lt;userid&amp;gt;&lt;/tt&gt; &lt;strong&gt;principal&lt;/strong&gt; depends on the authentication &lt;em&gt;back-end&lt;/em&gt; used (e.g.
&lt;tt class="docutils literal"&gt;github:leplatrem&lt;/tt&gt;).&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="a-few-examples"&gt;
&lt;h3&gt;A few examples&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Blog&lt;/strong&gt;&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="35%"&gt;&lt;/col&gt;
&lt;col width="18%"&gt;&lt;/col&gt;
&lt;col width="46%"&gt;&lt;/col&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Object&lt;/th&gt;
&lt;th class="head"&gt;Permissions&lt;/th&gt;
&lt;th class="head"&gt;Principals&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;bucket:blog&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;blog&lt;/span&gt; owner id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;collection:articles&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;group:moderators&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;read&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;record:569e28r98889&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;co-author&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Wiki&lt;/strong&gt;&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="35%"&gt;&lt;/col&gt;
&lt;col width="18%"&gt;&lt;/col&gt;
&lt;col width="46%"&gt;&lt;/col&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Object&lt;/th&gt;
&lt;th class="head"&gt;Permissions&lt;/th&gt;
&lt;th class="head"&gt;Principals&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;bucket:wiki&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;wiki&lt;/span&gt; administrator id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;collection:articles&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;read&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Polls&lt;/strong&gt;&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="34%"&gt;&lt;/col&gt;
&lt;col width="31%"&gt;&lt;/col&gt;
&lt;col width="35%"&gt;&lt;/col&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Object&lt;/th&gt;
&lt;th class="head"&gt;Permissions&lt;/th&gt;
&lt;th class="head"&gt;Principals&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;bucket:poll&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;admin&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;collection:create&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;collection:&amp;lt;poll&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;poll&lt;/span&gt; author id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;record:create&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Collaborative maps&lt;/strong&gt;&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="34%"&gt;&lt;/col&gt;
&lt;col width="31%"&gt;&lt;/col&gt;
&lt;col width="35%"&gt;&lt;/col&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Object&lt;/th&gt;
&lt;th class="head"&gt;Permissions&lt;/th&gt;
&lt;th class="head"&gt;Principals&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;bucket:maps&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;admin&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;collection:create&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;collection:&amp;lt;map&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;map&lt;/span&gt; author id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;read&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;record:&amp;lt;record&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;maintainer&lt;/span&gt; id&amp;gt;&lt;/tt&gt;
(&lt;em&gt;ex. event staff member
maintaining venues&lt;/em&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Platforms&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Of course, there are many ways to modelize common use cases. For instance, it's
possible to imagine a wiki platform (ala wikia.com) where wikis are private by
default and some pages can be published:&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="32%"&gt;&lt;/col&gt;
&lt;col width="30%"&gt;&lt;/col&gt;
&lt;col width="38%"&gt;&lt;/col&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Object&lt;/th&gt;
&lt;th class="head"&gt;Permissions&lt;/th&gt;
&lt;th class="head"&gt;Principals&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td rowspan="3"&gt;&lt;tt class="docutils literal"&gt;bucket:freewiki&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;administrator&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;collection:create&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;group:create&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;collection:&amp;lt;wiki&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;wiki&lt;/span&gt; owner id&amp;gt;&lt;/tt&gt;,
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;group:&amp;lt;editors&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;read&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;group:&amp;lt;readers&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;record:&amp;lt;page&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;read&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="the-http-api"&gt;
&lt;h3&gt;The HTTP API&lt;/h3&gt;
&lt;p&gt;During the creation of an object, the user is given the &lt;tt class="docutils literal"&gt;write&lt;/tt&gt; permission on
the object:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nf"&gt;PUT&lt;/span&gt; &lt;span class="nn"&gt;/v1/buckets/servicedenuages_blog&lt;/span&gt; &lt;span class="kr"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;1.1&lt;/span&gt;
&lt;span class="na"&gt;Authorization&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;Bearer 0b9c2625dc21ef05f6ad4ddf47c5f203837aa32ca42fced54c2625dc21efac32&lt;/span&gt;
&lt;span class="na"&gt;Accept&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;application/json&lt;/span&gt;

HTTP/1.1 201 Created
Content-Type: application/json; charset=utf-8

{
    "id": "servicedenuages_blog",
    "permissions": {
        "write": ["fxa:49d02d55ad10973b7b9d0dc9eba7fdf0"]
    }
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It's possible to add permissions using the &lt;tt class="docutils literal"&gt;PATCH&lt;/tt&gt; HTTP method.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nf"&gt;PATCH&lt;/span&gt; &lt;span class="nn"&gt;/v1/buckets/servicedenuages_blog/collections/articles&lt;/span&gt; &lt;span class="kr"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;1.1&lt;/span&gt;
&lt;span class="na"&gt;Authorization&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;Bearer 0b9c2625dc21ef05f6ad4ddf47c5f203837aa32ca42fced54c2625dc21efac32&lt;/span&gt;
&lt;span class="na"&gt;Accept&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;application/json&lt;/span&gt;

{
    "permissions": {
        "read": ["+system.Everyone"]
    }
}

HTTP/1.1 201 Created
Content-Type: application/json; charset=utf-8

{
    "id": "servicedenuages_blog",
    "permissions": {
        "write": ["fxa:49d02d55ad10973b7b9d0dc9eba7fdf0"],
        "read": ["system.Everyone"]
    }
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For &lt;tt class="docutils literal"&gt;PATCH&lt;/tt&gt;, we are thinking about using a syntax prefixed with a &lt;tt class="docutils literal"&gt;+&lt;/tt&gt; or
a &lt;tt class="docutils literal"&gt;-&lt;/tt&gt; to add or remove &lt;em&gt;principals&lt;/em&gt; on an ACL.&lt;/p&gt;
&lt;p&gt;It is also possible to do a &lt;tt class="docutils literal"&gt;PUT&lt;/tt&gt; to reset the ACLs, knowing that the &lt;tt class="docutils literal"&gt;PUT&lt;/tt&gt;
will then add the current user to the list. It's possible to use a &lt;tt class="docutils literal"&gt;PATCH&lt;/tt&gt; to
remove herself from the list. Adding the current user allows to avoid
situations where nobody has access to the data anymore.&lt;/p&gt;
&lt;div class="note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;The &lt;tt class="docutils literal"&gt;create&lt;/tt&gt; permission is used for a &lt;tt class="docutils literal"&gt;POST&lt;/tt&gt; but also for a &lt;tt class="docutils literal"&gt;PUT&lt;/tt&gt;
when the record doesn't exist.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="the-specific-case-of-user-data"&gt;
&lt;h3&gt;The specific case of user data&lt;/h3&gt;
&lt;p&gt;One of the current feature of &lt;em&gt;Kinto&lt;/em&gt; is to handle record collections by user.&lt;/p&gt;
&lt;p&gt;On &lt;em&gt;*nix&lt;/em&gt; systems, it's possible, for an application, to save configuration
for the current user in her personal folder, without bothering about its
specific location, using &lt;tt class="docutils literal"&gt;~&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;In our case, if an application want to save contacts for a user, it can use
a shortcut to reference the &lt;em&gt;personal&lt;/em&gt; bucket of the user:
&lt;tt class="docutils literal"&gt;/buckets/personal/collections/contacts&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;This URL will return a &lt;tt class="docutils literal"&gt;HTTP 307&lt;/tt&gt; to the current user &lt;em&gt;bucket&lt;/em&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nf"&gt;POST&lt;/span&gt; &lt;span class="nn"&gt;/v1/buckets/personal/collections/contacts/records&lt;/span&gt; &lt;span class="kr"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;1.1&lt;/span&gt;

{
   "name": "Rémy",
   "emails": ["remy@example.com"],
   "phones": ["+330820800800"]
}

HTTP/1.1 307 Temporary Redirect
Location: /v1/buckets/fxa:49d02d55ad10973b7b9d0dc9eba7fdf0/collections/contacts/records
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Like so, it's possible for Alice to share her contacts with Bob. She just have
to give the &lt;tt class="docutils literal"&gt;read&lt;/tt&gt; permission to Bob on her collection and give him the
complete URL:
&lt;tt class="docutils literal"&gt;/v1/buckets/fxa:49d02d55ad10973b7b9d0dc9eba7fdf0/collections/contacts/records&lt;/tt&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id6"&gt;
&lt;h3&gt;Permissions delegation&lt;/h3&gt;
&lt;p&gt;In &lt;em&gt;Kinto&lt;/em&gt;, we defined a format to restrict permissions using OAuth2 scopes:
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;storage:&amp;lt;bucket_id&amp;gt;:&amp;lt;collection_id&amp;gt;:&amp;lt;permissions_list&amp;gt;&lt;/span&gt;&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Taking back the previous &lt;em&gt;tasks&lt;/em&gt; example, it is possible for Bob to create
a specific OAuth2 token with the following &lt;em&gt;scopes&lt;/em&gt;:
&lt;tt class="docutils literal"&gt;profile storage:todolist:tasks:write storage:personal:contacts:read+records:create&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Like so, even if Bob has the &lt;tt class="docutils literal"&gt;write&lt;/tt&gt; permission on his contacts, the
application using this token will only be able to read the existing contacts
and add new ones.&lt;/p&gt;
&lt;p&gt;One part of the complexity is to manage presenting these &lt;em&gt;scopes&lt;/em&gt; in a readable
way to the user, so she or he is able to chose which permissions to give to the
applications acting on her behalf.&lt;/p&gt;
&lt;p&gt;So, here is where we're at with our thinking!&lt;/p&gt;
&lt;p&gt;If you have things to add or discuss with this proposal, don't hesitate to
interrupt us while it's still possible!&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</summary></entry><entry><title>Ecosystem &amp; generic storage</title><link href="http://www.servicedenuages.fr/en/generic-storage-ecosystem" rel="alternate"></link><updated>2015-04-30T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-04-30:en/generic-storage-ecosystem</id><summary type="html">&lt;div class="note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;This article was translated from French by Julien/Sphinx. We thank him a lot
for this effort! Note, that at the beginning of this year,
&lt;a class="reference external" href="https://medium.com/@Sphinx/mdn-pr%C3%A9sentation-de-la-documentation-javascript-70541cecae54"&gt;he also translated MDN to French&lt;/a&gt;!
&lt;strong&gt;Big up !&lt;/strong&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;tl;dr We have to build a service to track payments, and we're hesitant
to go on with our own solution for storage and synchronization.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;As we wrote in &lt;a class="reference external" href="http://www.servicedenuages.fr/en/../service-de-nuages"&gt;the previous article (FR)&lt;/a&gt;,
we want to build a solution for generic data storage. We reboot &lt;a class="reference external" href="http://daybed.readthedocs.org"&gt;Daybed&lt;/a&gt;
at Mozilla !&lt;/p&gt;
&lt;p&gt;Our goal is simple: allow developers, whether they are from Mozilla or from the whole world,
to easily synchronize and save data associated to a user.&lt;/p&gt;
&lt;p id="storage-specs"&gt;Here are the aspects of the architecture that seem essential to us:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;The solution must rely on a protocol, not on a particular implementation;&lt;/li&gt;
&lt;li&gt;Self-hosting of the whole solution must be dead simple;&lt;/li&gt;
&lt;li&gt;Authentication must be pluggable or decentralized (OAuth2, FxA, Persona);&lt;/li&gt;
&lt;li&gt;The server should be able to validate records;&lt;/li&gt;
&lt;li&gt;An authorization/permissions system must allow collection protection or
fine-grained records sharing;&lt;/li&gt;
&lt;li&gt;Conflicts resolution could happen server-side;&lt;/li&gt;
&lt;li&gt;Clients should be «&lt;em&gt;offline-first&lt;/em&gt;»;&lt;/li&gt;
&lt;li&gt;Clients should be able to easily merge/reconciliate data;&lt;/li&gt;
&lt;li&gt;Clients should be usable in the browser &lt;em&gt;and&lt;/em&gt; server-side;&lt;/li&gt;
&lt;li&gt;Every component should be simple and easily substituable.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The first question we were asked was: «&lt;em&gt;Why don't you rather use PouchDB or Remote Storage?&lt;/em&gt;»&lt;/p&gt;
&lt;div class="section" id="remote-storage"&gt;
&lt;h2&gt;Remote Storage&lt;/h2&gt;
&lt;p&gt;Remote Storage is an open standard for user storage. &lt;a class="reference external" href="http://tools.ietf.org/html/draft-dejong-remotestorage-04"&gt;The specification&lt;/a&gt;
is based on existing and proven standards: Webfinger, OAuth2, CORS and REST.&lt;/p&gt;
&lt;p&gt;The API is pretty simple and &lt;a class="reference external" href="http://blog.cozycloud.cc/news/2014/08/12/when-unhosted-meets-cozy-cloud/"&gt;prestigious projects are using it&lt;/a&gt;.
There exist several &lt;a class="reference external" href="https://github.com/jcoglan/restore"&gt;server implementations&lt;/a&gt;
and there is even a &lt;a class="reference external" href="https://www.npmjs.com/package/remotestorage-server"&gt;Node squeleton&lt;/a&gt;
to build a custom server.&lt;/p&gt;
&lt;img alt="Remote Storage widget" class="align-left" src="http://www.servicedenuages.fr/en/../images/remotestorage-widget.png" style="width: 243px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;The &lt;a class="reference external" href="https://github.com/remotestorage/remotestorage.js/"&gt;remoteStorage.js client&lt;/a&gt;
makes possible the integration of this solution in Web apps. This client is in charge of the «local store»,
caching, syncing and gives users a widget so that they can choose the server
which will receive the data (using Webfinger).&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://github.com/michielbdejong/ludbud"&gt;ludbud&lt;/a&gt;, a refined version of
&lt;em&gt;remoteStorage.js&lt;/em&gt; limits itself to the abstraction of the remote data storage.
At the end, it would be possible to have a single library and to store data
in either a &lt;em&gt;Remote Storage&lt;/em&gt; server, an &lt;em&gt;ownCloud&lt;/em&gt; server, or even on the bad guys'
like &lt;em&gt;Google Drive&lt;/em&gt; or &lt;em&gt;Dropbox&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;At first sight, the specification seemed to fit with what we want to do:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;The philosophy of the protocol is sound;&lt;/li&gt;
&lt;li&gt;The ecosystem is well-thought;&lt;/li&gt;
&lt;li&gt;The political vision fits: give back the control of the data to the users
(see &lt;a class="reference external" href="http://unhosted.org/"&gt;unhosted&lt;/a&gt;);&lt;/li&gt;
&lt;li&gt;Technical choices are compatible with what we've already started (CORS, REST, OAuth2);&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;However, regarding data manipulation, there are several differences with what we want to do:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;The API seems «files» oriented (folders and documents) and not «data» (collections and records);&lt;/li&gt;
&lt;li&gt;There is no record validation following some schema (though &lt;a class="reference external" href="https://remotestorage.io/doc/code/files/baseclient/types-js.html"&gt;some implementations&lt;/a&gt; of the protocol are actually doing this);&lt;/li&gt;
&lt;li&gt;There is no option to sort/filter records with regards to their attributes;&lt;/li&gt;
&lt;li&gt;The permission system &lt;a class="reference external" href="https://groups.google.com/forum/#!topic/unhosted/5_NOGq8BPTo"&gt;is limited to private/public&lt;/a&gt; (and
&lt;a class="reference external" href="https://github.com/remotestorage/spec/issues/58#issue-27249452"&gt;the author is going for a git-like model&lt;/a&gt;) &lt;a class="footnote-reference" href="#id3" id="id1"&gt;[1]&lt;/a&gt;;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To summarize, it would seem that what we want to achieve with the storage of
records is complementary to &lt;em&gt;Remote Storage&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;If there are some needs about «file oriented» persistence, it would be dull to
reinvent this solution. So there is a great chance that we will integrate
&lt;em&gt;Remote Storage&lt;/em&gt; some day and that it will become a facet of our solution.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="pouchdb"&gt;
&lt;h2&gt;PouchDB&lt;/h2&gt;
&lt;p&gt;&lt;a class="reference external" href="http://pouchdb.com/"&gt;PouchDB&lt;/a&gt; is a Javascript library allowing to manipulate
records locally and synchronize them to a distant database.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;PouchDB&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'dbname'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="nx"&gt;db&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;put&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
 &lt;span class="nx"&gt;_id&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'dave@gmail.com'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
 &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'David'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
 &lt;span class="nx"&gt;age&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;68&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;

&lt;span class="nx"&gt;db&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;replicate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;to&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'http://example.com/mydb'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The project sees some traction and benefits from a lot of contributors. The
ecosystem is rich and adoption by projects &lt;a class="reference external" href="https://github.com/hoodiehq/wip-hoodie-store-on-pouchdb"&gt;such as Hoodie&lt;/a&gt; confirms the tool
pertinence for frontend developers.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;PouchDB&lt;/em&gt; handles a local « store » which persistence is abstract and
&lt;a class="reference external" href="http://pouchdb.com/2014/07/25/pouchdb-levels-up.html"&gt;is built on top&lt;/a&gt;
of the &lt;a class="reference external" href="https://github.com/level/levelup#relationship-to-leveldown"&gt;LevelDown API&lt;/a&gt;
to persist data in &lt;a class="reference external" href="https://github.com/Level/levelup/wiki/Modules#storage-back-ends"&gt;any backend&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Even if &lt;em&gt;PouchDB&lt;/em&gt; is mainly done for «&lt;em&gt;offline-first&lt;/em&gt;» applications, it
can be used inside browsers and on the server side, via Node.&lt;/p&gt;
&lt;div class="section" id="synchronization"&gt;
&lt;h3&gt;Synchronization&lt;/h3&gt;
&lt;p&gt;Local data synchronization (or replication) is done on a remote
&lt;a class="reference external" href="http://couchdb.apache.org/"&gt;CouchDB&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The &lt;a class="reference external" href="https://github.com/pouchdb/pouchdb-server"&gt;PouchDB Server&lt;/a&gt; project
implements the CouchDB API in NodeJS. Because &lt;em&gt;PouchDB&lt;/em&gt; itself is used, we
obtain a service which is behaving like a &lt;em&gt;CouchDB&lt;/em&gt;, but stores data
anywhere (in a &lt;em&gt;Redis&lt;/em&gt; or a &lt;em&gt;PostgreSQL&lt;/em&gt; database for instance).&lt;/p&gt;
&lt;p&gt;The synchronisation is complete. In other words, all records that are on
the server will end up being synchronised with the client. It is possible to filter
synchronized collections but &lt;a class="reference external" href="http://pouchdb.com/2015/04/05/filtered-replication.html"&gt;its purpose is not to secure data access&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In order to do so, it is recommanded to create &lt;a class="reference external" href="https://github.com/nolanlawson/pouchdb-authentication#some-people-can-read-some-docs-some-people-can-write-those-same-docs"&gt;a database per user&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This isn't necessarily a problem since CouchDB &lt;a class="reference external" href="https://mail-archives.apache.org/mod_mbox/couchdb-user/201401.mbox/%3C52CEB873.7080404@ironicdesign.com%3E"&gt;can handle hundreds of thousands
of databases without any problem&lt;/a&gt;.
However, depending on use cases, clustering and isolation (by role, application,
collection, ...) might not be dealt with easily.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="the-payments-use-case"&gt;
&lt;h2&gt;The « Payments » use case&lt;/h2&gt;
&lt;img alt="Put Payments Here  -- Before the Internet - CC-NC-SA Katy Silberger https://www.flickr.com/photos/katysilbs/11163812186" src="http://www.servicedenuages.fr/en/../images/put-payments.jpg" style="width: 640px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;During the next weeks, we will have to setup a prototype that keeps an history
of a user's payments and subscriptions.&lt;/p&gt;
&lt;p&gt;The requirements are simple:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;The « Payment » application tracks payments and subscriptions of a user
for a given application;&lt;/li&gt;
&lt;li&gt;The « Data » application requests the service to check if a user paid or
has suscribed;&lt;/li&gt;
&lt;li&gt;The user requests the service to get a list of all payments/subscriptions
reltated to her.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The « Payment » application only should have the right to create/modify/delete
records. The two others can only have read-only access to these records.&lt;/p&gt;
&lt;p&gt;A given application cannot access to some other application payments and a given user cannot access to some other user's payments.&lt;/p&gt;
&lt;div class="section" id="with-remotestorage"&gt;
&lt;h3&gt;With RemoteStorage&lt;/h3&gt;
&lt;img alt="Remote Love - CC-BY-NC Julie https://www.flickr.com/photos/mamajulie2008/2609549461" class="align-center" src="http://www.servicedenuages.fr/en/../images/remote-love.jpg" style="width: 640px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;The idea of &lt;em&gt;Remote Storage&lt;/em&gt; is to separate the application from the data that
the user created with the application.&lt;/p&gt;
&lt;p&gt;In our use case, the « Payment » app is dealing with the data concerning a user.
However, this data does not directly belong to the user. A user should be able
to delete some records but he/she cannot create or edit some existing payments!&lt;/p&gt;
&lt;p&gt;The concept of permissions, limited to private/public is not suitable here.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="with-pouchdb"&gt;
&lt;h3&gt;With PouchDB&lt;/h3&gt;
&lt;p&gt;It will be necessary to create a &lt;em&gt;database&lt;/em&gt; per user in order to separate the
records in a secure way. Only the « Payment » app will be granted full rights
on the different databases.&lt;/p&gt;
&lt;p&gt;But this won't be enough.&lt;/p&gt;
&lt;p&gt;An app must not see payments from another application so it would also be
necessary to create a database per application.&lt;/p&gt;
&lt;p&gt;When a user will need to access payments, it will be mandatory to join every
&lt;em&gt;database&lt;/em&gt; of every application for this current user. When the marketing
department will want to build stats for all apps, one will have to join hundreds
of thousands of databases.&lt;/p&gt;
&lt;p&gt;This doesn't seem appropriate: most of the time, there are only few
payments/subscriptions for a given user. Should we have hundreds of thousands of
databases, each of which will have less than 5 records?&lt;/p&gt;
&lt;p&gt;Moreover, the server side of « Payment » is implemented with Python, using a
JavaScript wrapper (as &lt;a class="reference external" href="https://pythonhosted.org/Python-PouchDB/"&gt;python-pouchdb&lt;/a&gt;) is not something we thrive for.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="a-new-ecosystem"&gt;
&lt;h2&gt;A new ecosystem?&lt;/h2&gt;
&lt;img alt="Wagon wheel - CC-BY-NC-SA arbyreed https://www.flickr.com/photos/19779889@N00/16161808220" src="http://www.servicedenuages.fr/en/../images/wagon-wheel.jpg" style="width: 640px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;It is obvious that &lt;em&gt;PouchDB&lt;/em&gt; and &lt;em&gt;Remote Storage&lt;/em&gt; are rich projects with dynamic communities. Therefore, it's reasonable to wonder if one should develop another solution.&lt;/p&gt;
&lt;p&gt;When we created the &lt;em&gt;Reading List&lt;/em&gt; server, we built it with
&lt;a class="reference external" href="http://cliquet.readthedocs.org/"&gt;Cliquet&lt;/a&gt;. We had a chance to setup &lt;a class="reference external" href="http://cliquet.readthedocs.org/en/latest/api/"&gt;a very simple protocol&lt;/a&gt;, strongly inspired by
&lt;a class="reference external" href="http://en.wikipedia.org/wiki/Firefox_Sync"&gt;Firefox Sync&lt;/a&gt;, to sync records.&lt;/p&gt;
&lt;p&gt;The reason clients for &lt;em&gt;Reading List&lt;/em&gt; were implemented in few weeks, whether in
JavaScript, Java (Android) or ASM (Firefox addon), is that the «&lt;em&gt;offline first&lt;/em&gt;»
principle of the service is trivial.&lt;/p&gt;
&lt;div class="section" id="tradeoffs"&gt;
&lt;h3&gt;Tradeoffs&lt;/h3&gt;
&lt;p&gt;Of course, we don't intend to compete with &lt;em&gt;CouchDB&lt;/em&gt; and are making some
concessions:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Per default, records collections are isolated by user;&lt;/li&gt;
&lt;li&gt;There is no history of revisions;&lt;/li&gt;
&lt;li&gt;There is no diff between each revision;&lt;/li&gt;
&lt;li&gt;Per default, there is no automatic conflict resolution;&lt;/li&gt;
&lt;li&gt;There is no stream synchronization.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If we are not mistaken, these tradeoffs exclude the possibility of
implementing &lt;a class="reference external" href="https://github.com/pouchdb/pouchdb/blob/master/lib/adapters/http/http.js#L721-L946"&gt;a PouchDB adapter&lt;/a&gt; for the HTTP-based synchronisation protocol of &lt;em&gt;Cliquet&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Too bad since it would have been a great opportunity to capitalize on the user
experience of &lt;em&gt;PouchDB&lt;/em&gt; regarding the synchronisation client.&lt;/p&gt;
&lt;p&gt;However, we have some interesting features:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;No map-reduce;&lt;/li&gt;
&lt;li&gt;Partial and/or ordered and/or paginated synchronisation;&lt;/li&gt;
&lt;li&gt;The client can choose, with headers, to delete the data or to accept the
server version;&lt;/li&gt;
&lt;li&gt;A single server is deployed for N apps;&lt;/li&gt;
&lt;li&gt;Self hosting is dead simple;&lt;/li&gt;
&lt;li&gt;The client can choose not to use local storage at all;&lt;/li&gt;
&lt;li&gt;The JavaScript client will have its local store management delegated (we're
thinking about &lt;a class="reference external" href="https://github.com/mozilla/localForage"&gt;LocalForage&lt;/a&gt; or
&lt;a class="reference external" href="https://github.com/dfahlander/Dexie.js"&gt;Dexie.js&lt;/a&gt;);&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;And we are complying with &lt;a class="reference external" href="#storage-specs"&gt;the specs we drew at the beginning of the article&lt;/a&gt;!&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="philosophical-arguments"&gt;
&lt;h3&gt;Philosophical arguments&lt;/h3&gt;
&lt;p&gt;It's &lt;a class="reference external" href="http://en.wikipedia.org/wiki/Law_of_the_instrument"&gt;illusionary to think that we can achieve everything with a single tool&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We have other use cases that seem to fit with &lt;em&gt;PouchDB&lt;/em&gt; (&lt;em&gt;no concept of
permission or sharing, JavaScript environment, ...&lt;/em&gt;). We'll take advantage of it
when relevant!&lt;/p&gt;
&lt;p&gt;The ecosystem we want to build should address the use cases that are badly
handled by &lt;em&gt;PouchDB&lt;/em&gt;. It should be:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Based on our very simple protocol;&lt;/li&gt;
&lt;li&gt;Minimalist and with multiple purposes (&lt;em&gt;like our very French 2CV&lt;/em&gt;);&lt;/li&gt;
&lt;li&gt;Naive (&lt;em&gt;no rocket-science&lt;/em&gt;);&lt;/li&gt;
&lt;li&gt;Without magic (&lt;em&gt;explicit and easy to reimplement from scratch&lt;/em&gt;);&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a class="reference external" href="http://cliquet.readthedocs.org/en/latest/rationale.html"&gt;The philosophy and the features of our Python toolkit, Cliquet&lt;/a&gt;, will of course be honoured :)&lt;/p&gt;
&lt;p&gt;As for &lt;em&gt;Remote Storage&lt;/em&gt;, whenever we face the need, we will proud to join
this initiative. However, as for now, it seems risky to start by bending the
solution to our own needs.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="practical-arguments"&gt;
&lt;h3&gt;Practical arguments&lt;/h3&gt;
&lt;p&gt;Before being willingly to deploy a &lt;em&gt;CouchDB&lt;/em&gt; solution, Mozilla &lt;em&gt;ops&lt;/em&gt; will ask us
to precisely prove that it's not currently doable with experienced stacks (e.g.
MySQL, Redis, PostgreSQL).&lt;/p&gt;
&lt;p&gt;We will also have to guarantee a minimum 5 years lifetime regarding the data. With
&lt;em&gt;Cliquet&lt;/em&gt;, using the PostgreSQL backend, our data is persisted in &lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/blob/40aa33/cliquet/storage/postgresql/schema.sql#L14-L28"&gt;a flat PostgreSQL schema&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This wouldn't be the case with a LevelDown adapter that handles revisions split
in a key-value scheme.&lt;/p&gt;
&lt;p&gt;If we based our service on Cliquet, like we did with &lt;a class="reference external" href="http://kinto.readthedocs.org"&gt;Kinto&lt;/a&gt;, all the automation work of deploying
(&lt;em&gt;monitoring, RPM builds, Puppet...&lt;/em&gt;) that was done for &lt;em&gt;Reading List&lt;/em&gt; will be
completely reusable.&lt;/p&gt;
&lt;p&gt;As said before, if we go with another totally new stack, we will have to start
again from scratch, including lapping, profiling, optimizing, all of which has
already been done during the first quarter of this year for Reading List.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="next-steps"&gt;
&lt;h2&gt;Next steps&lt;/h2&gt;
&lt;p&gt;It's still time to change our strategy :) And we welcome any feedback!
It's always a difficult decision to make... &lt;tt class="docutils literal"&gt;&amp;lt;/troll call&amp;gt;&lt;/tt&gt;&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Twist an existing ecosystem vs build a new custom one;&lt;/li&gt;
&lt;li&gt;Master the whole system or to integrate our solution;&lt;/li&gt;
&lt;li&gt;Contribute vs redo;&lt;/li&gt;
&lt;li&gt;Guide vs follow.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We really seek to join the &lt;a class="reference external" href="https://nobackend.org/"&gt;no-backend&lt;/a&gt; initiative.
This first step might lead us to converge in the end! Maybe our service will end
up being compatible with Remote Storage, maybe PouchDB will become more agnostic
regarding the synchronisation protocol...&lt;/p&gt;
&lt;img alt="XKCD — Standards https://xkcd.com/927/" src="http://www.servicedenuages.fr/en/../images/standards.png" style="width: 500px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Using this new ecosystem for the « Payments » project will allow us to setup a
suitable permission system (&lt;em&gt;probably built on OAuth scopes&lt;/em&gt;). We are also
looking forward to &lt;a class="reference external" href="http://blog.daybed.io/daybed-revival.html"&gt;capitalizing on our Daybed experience for this project&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We'll also extract some parts of the clients source code that were implemented
for &lt;em&gt;Reading List&lt;/em&gt; in order to provide a minimalist JavaScript client.&lt;/p&gt;
&lt;p&gt;By going this way, we are taking several risks:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;reinventing a wheel we don't know;&lt;/li&gt;
&lt;li&gt;failing to make the &lt;em&gt;Cliquet&lt;/em&gt; ecosystem a community project;&lt;/li&gt;
&lt;li&gt;failing to place &lt;em&gt;Cliquet&lt;/em&gt; in the niche for the use cases that are not
covered with &lt;em&gt;PouchDB&lt;/em&gt; :)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;As &lt;a class="reference external" href="http://pouchdb.com/2015/04/05/filtered-replication.html"&gt;Giovanni Ornaghi said&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
Rolling out your set of webservices, push notifications, or background services
might give you more control, but at the same time it will force you to engineer,
write, test, and maintain a whole new ecosystem.&lt;/blockquote&gt;
&lt;p&gt;And this ecosystem is precisely the one that &lt;em&gt;Mozilla Cloud Services&lt;/em&gt; team
is in charge of!&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id3" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;The &lt;a class="reference external" href="https://sharesome.5apps.com/"&gt;Sharesome project&lt;/a&gt; allows for some
public sharing of one's resources from one's &lt;em&gt;Remote Storage&lt;/em&gt;.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
</summary></entry><entry><title>Service de nuages !</title><link href="http://www.servicedenuages.fr/en/service-de-nuages" rel="alternate"></link><updated>2015-04-16T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-04-16:en/service-de-nuages</id><summary type="html">&lt;p&gt;A bunch of changes since the beginning of the year for the "cloud-services"
frenchies!&lt;/p&gt;
&lt;p&gt;First of all, two new recruits are here to complement the team:
&lt;a class="reference external" href="https://nicolas.perriault.net/"&gt;n1k0&lt;/a&gt; and &lt;a class="reference external" href="http://mathieu-leplatre.info"&gt;Mathieu&lt;/a&gt; are now helping out &lt;a class="reference external" href="http://ziade.org/"&gt;Tarek&lt;/a&gt;, &lt;a class="reference external" href="http://natim.ionyse.com"&gt;Rémy&lt;/a&gt; and &lt;a class="reference external" href="http://notmyidea.org"&gt;Alexis&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The starting of this year has seen the launch of &lt;a class="reference external" href="https://www.mozilla.org/en-US/firefox/hello/"&gt;Firefox Hello&lt;/a&gt; which allowed us to scale up
&lt;a class="reference external" href="https://github.com/mozilla-services/loop-server"&gt;the server&lt;/a&gt;,
written in Node.js®.&lt;/p&gt;
&lt;div class="section" id="a-readinglist-server"&gt;
&lt;h2&gt;A readinglist server&lt;/h2&gt;
&lt;p&gt;In parallel, a project about &lt;a class="reference external" href="https://readinglist.readthedocs.org"&gt;synchronizing reading lists&lt;/a&gt; (&lt;em&gt;Reading List&lt;/em&gt;) started.
The idea is to be able to bookmark pages to "read for later" and continue the
reading on any synchronized device (Firefox for Android or Firefox Desktop). An
open source counterpart to &lt;a class="reference external" href="http://getpocket.com"&gt;Pocket&lt;/a&gt;, in some regards, which is possible to host
yourself.&lt;/p&gt;
&lt;img alt="Capture of Firefox nightly with the readinglist." src="http://www.servicedenuages.fr/en/../images/readinglist-screenshot.png" style="width: 953px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;To build this service, we could have reused &lt;a class="reference external" href="https://github.com/mozilla-services/server-syncstorage"&gt;Firefox sync&lt;/a&gt; , after all it's
a robust synchronisation service, built on top of &lt;a class="reference external" href="http://cornice.readthedocs.org/"&gt;Cornice&lt;/a&gt;. But &lt;em&gt;Sync&lt;/em&gt; hasn't
been thought to guarantee strong data integrity and it was too complex to change that
deeply.&lt;/p&gt;
&lt;p&gt;We could also have created yet another application to expose an API and
persist data in a database.&lt;/p&gt;
&lt;p&gt;But, this little new team isn't here just by luck.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="the-daybed-team"&gt;
&lt;h2&gt;The «Daybed Team»&lt;/h2&gt;
&lt;p&gt;We share a vision: a generic data storage service! Maybe it brings to memories
&lt;a class="reference external" href="https://daybed.io"&gt;a certain project named Daybed&lt;/a&gt;?&lt;/p&gt;
&lt;p&gt;For client applications, JavaScript or other, using this service should be as
easy as a pie! The application handles its data locally (offline-first) and
synchronizes upon request.&lt;/p&gt;
&lt;p&gt;Here, the heart of the &lt;em&gt;Reading List&lt;/em&gt; service is a "CRUD" API (Create, Retrieve,
Update, Delete), which handles synchronisation and authentication. We made the
bet to do a "simple" API, with the less specific code as possible, which would
create the basis of a generic service. Also because it's likely that other
similar projects will follow.&lt;/p&gt;
&lt;p&gt;A bunch of experience was accumulated within the team, on one hand with the
creation and evolution of &lt;em&gt;Firefox Sync&lt;/em&gt; and on the other hand with &lt;em&gt;Daybed&lt;/em&gt;
our side-project. We try to not reproduce the same mistakes while keeping
concepts which proved to be valid.&lt;/p&gt;
&lt;p&gt;For instance, we kept the &lt;em&gt;timestamp&lt;/em&gt; mechanism of &lt;em&gt;Sync&lt;/em&gt;, which is used to
synchronize collections. As these problematics are recurring or even impossible
to avoid, we decided to build on top of this synchronization protocol and to
dissociate it from the readinglist project.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="the-one-way-mechanism"&gt;
&lt;h2&gt;The one-way mechanism&lt;/h2&gt;
&lt;p&gt;As a first stone to build the cathedral, we created &lt;a class="reference external" href="https://cliquet.readthedocs.org"&gt;Cliquet&lt;/a&gt;, which main idea is to have an
implementation of this protocol in Python, while factorizing all our good
practices (notably for putting everything in production).&lt;/p&gt;
&lt;img alt="Cliquet's logo" class="align-right" src="http://www.servicedenuages.fr/en/../images/cliquet-logo.png" style="width: 300px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;The good thing with protocols (as opposed to monoliths) is that if you prefer
Asyncio, io.js or Go, we will encourage you to publish your alternative
implementation!&lt;/p&gt;
&lt;p&gt;With &lt;em&gt;Cliquet&lt;/em&gt;, the code of the readinglist service consists into defining
a schema for the records and force some field values on certain calls. The size
of the project is dramatically reduced to a dozen lines of code.&lt;/p&gt;
&lt;p&gt;As to the future generic data storage service, &lt;a class="reference external" href="http://kinto.readthedocs.org"&gt;the project&lt;/a&gt; just started but it really is!
It can already be used as a storage backend in a &lt;em&gt;Cliquet&lt;/em&gt; application, and
this was &lt;a class="reference external" href="https://github.com/mozilla-services/kinto/blob/0.2.1/kinto/views/collection.py"&gt;implemented in only 20 lines of code&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Oh, and this time we will build features only from real use cases which are
coming along the way. It might seem silly, but on &lt;em&gt;Daybed&lt;/em&gt; we never made that point.&lt;/p&gt;
&lt;p&gt;In future articles, we want to describe the good practices we put together in
the protocol (or &lt;em&gt;Cliquet&lt;/em&gt;), certain specific technical points and present our
vision with examples and tutorials.&lt;/p&gt;
&lt;p&gt;See you soon, then!&lt;/p&gt;
&lt;/div&gt;
</summary></entry><entry><title>Le printemps</title><link href="http://www.servicedenuages.fr/en/spring" rel="alternate"></link><updated>2015-04-15T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-04-15:en/spring</id><summary type="html">&lt;p&gt;It's spring already, and a good time to tidy-up a bit our minds!&lt;/p&gt;
&lt;p&gt;We've been stacking interesting experiences without really sharing them in
writings, so now's the time.&lt;/p&gt;
&lt;p&gt;There were a francophone conference about Hawk the past year, and some articles
in English in the Mozilla blog, but sometimes the English language doesn't let
us express ourselves in a compelling way.&lt;/p&gt;
&lt;p&gt;That's why, in this beginning of spring 2015, we propose a set of articles
written in French and translated in English whenever we can, about what we do in
our little &lt;em&gt;Service des nuages&lt;/em&gt; team at Mozilla.&lt;/p&gt;
&lt;img alt="Our very own logo" src="http://www.servicedenuages.fr/en/../images/service_de_nuages.png" style="width: 2268px; height: auto; max-width: 100%;"/&gt;
</summary></entry></feed>